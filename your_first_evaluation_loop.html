<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.29.3">
    <meta name="project" content="Axon v0.6.0">

    <title>Your first evaluation loop — Axon v0.6.0</title>
    <link rel="stylesheet" href="dist/html-elixir-MB5C7R66.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-XRYTXUVD.js"></script>
    <script src="dist/sidebar_items-BB9179B2.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-EHGDP2LQ.js"></script>


  </head>
  <body data-type="extras" class="page-livemd">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="Axon.html">
        <img src="assets/logo.png" alt="Axon" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.6.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="icon-action display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/elixir-nx/axon/blob/v0.6.0/guides/training_and_evaluation/your_first_evaluation_loop.livemd#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>


  <span>Your first evaluation loop</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="5057681776-1">(</span><span class="p" data-group-id="5057681776-2">[</span><span class="w">
  </span><span class="p" data-group-id="5057681776-3">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;= 0.5.0&quot;</span><span class="p" data-group-id="5057681776-3">}</span><span class="w">
</span><span class="p" data-group-id="5057681776-2">]</span><span class="p" data-group-id="5057681776-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">:ok</span></code></pre><h2 id="creating-an-axon-evaluation-loop" class="section-heading">
  <a href="#creating-an-axon-evaluation-loop" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">creating-an-axon-evaluation-loop</p>
  </a>
  Creating an Axon evaluation loop
</h2>
<p>Once you have a trained model, it's necessary to test the trained model on some test data. Axon's loop abstraction is general enough to work for both training and evaluating models. Just as Axon implements a canned <a href="Axon.Loop.html#trainer/3"><code class="inline">Axon.Loop.trainer/3</code></a> factory, it also implements a canned <a href="Axon.Loop.html#evaluator/1"><code class="inline">Axon.Loop.evaluator/1</code></a> factory.</p><p><a href="Axon.Loop.html#evaluator/1"><code class="inline">Axon.Loop.evaluator/1</code></a> creates an evaluation loop which you can instrument with metrics to measure the performance of a trained model on test data. First, you need a trained model:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="4658840872-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="4658840872-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="4658840872-2">(</span><span class="mi">8</span><span class="p" data-group-id="4658840872-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="4658840872-3">(</span><span class="p" data-group-id="4658840872-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="4658840872-4">(</span><span class="mi">4</span><span class="p" data-group-id="4658840872-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="4658840872-5">(</span><span class="p" data-group-id="4658840872-5">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="4658840872-6">(</span><span class="mi">1</span><span class="p" data-group-id="4658840872-6">)</span><span class="w">

</span><span class="n">train_loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="4658840872-7">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="ss">:mean_squared_error</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="4658840872-7">)</span><span class="w">

</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Stream</span><span class="o">.</span><span class="n">repeatedly</span><span class="p" data-group-id="4658840872-8">(</span><span class="k" data-group-id="4658840872-9">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="4658840872-10">{</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="c">_next_key</span><span class="p" data-group-id="4658840872-10">}</span><span class="w"> </span><span class="o">=</span><span class="w">
      </span><span class="nc">:random</span><span class="o">.</span><span class="n">uniform</span><span class="p" data-group-id="4658840872-11">(</span><span class="mi">9999</span><span class="p" data-group-id="4658840872-11">)</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx.Random</span><span class="o">.</span><span class="n">key</span><span class="p" data-group-id="4658840872-12">(</span><span class="p" data-group-id="4658840872-12">)</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx.Random</span><span class="o">.</span><span class="n">normal</span><span class="p" data-group-id="4658840872-13">(</span><span class="ss">shape</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4658840872-14">{</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4658840872-14">}</span><span class="p" data-group-id="4658840872-13">)</span><span class="w">

    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">sin</span><span class="p" data-group-id="4658840872-15">(</span><span class="n">xs</span><span class="p" data-group-id="4658840872-15">)</span><span class="w">
    </span><span class="p" data-group-id="4658840872-16">{</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p" data-group-id="4658840872-16">}</span><span class="w">
  </span><span class="k" data-group-id="4658840872-9">end</span><span class="p" data-group-id="4658840872-8">)</span><span class="w">

</span><span class="n">trained_model_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4658840872-17">(</span><span class="n">train_loop</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4658840872-18">%{</span><span class="p" data-group-id="4658840872-18">}</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p" data-group-id="4658840872-17">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">950</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1285532</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="6877347879-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-3">#</span><span class="nc" data-group-id="6877347879-3">Nx.Tensor</span><span class="p" data-group-id="6877347879-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6877347879-4">[</span><span class="mi">8</span><span class="p" data-group-id="6877347879-4">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-5">[</span><span class="o">-</span><span class="mf">0.06848274916410446</span><span class="p">,</span><span class="w"> </span><span class="mf">0.037988610565662384</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.199247345328331</span><span class="p">,</span><span class="w"> </span><span class="mf">0.18008524179458618</span><span class="p">,</span><span class="w"> </span><span class="mf">0.10976515710353851</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.10479626059532166</span><span class="p">,</span><span class="w"> </span><span class="mf">0.562850832939148</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.030415315181016922</span><span class="p" data-group-id="6877347879-5">]</span><span class="w">
    </span><span class="p" data-group-id="6877347879-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-6">#</span><span class="nc" data-group-id="6877347879-6">Nx.Tensor</span><span class="p" data-group-id="6877347879-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6877347879-7">[</span><span class="mi">1</span><span class="p" data-group-id="6877347879-7">]</span><span class="p" data-group-id="6877347879-8">[</span><span class="mi">8</span><span class="p" data-group-id="6877347879-8">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-9">[</span><span class="w">
        </span><span class="p" data-group-id="6877347879-10">[</span><span class="o">-</span><span class="mf">0.2839881181716919</span><span class="p">,</span><span class="w"> </span><span class="mf">0.11133058369159698</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5213645100593567</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.14406965672969818</span><span class="p">,</span><span class="w"> </span><span class="mf">0.37532612681388855</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.28965434432029724</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.9048429131507874</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">5.540614947676659e-4</span><span class="p" data-group-id="6877347879-10">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-9">]</span><span class="w">
    </span><span class="p" data-group-id="6877347879-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6877347879-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-11">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-12">#</span><span class="nc" data-group-id="6877347879-12">Nx.Tensor</span><span class="p" data-group-id="6877347879-12">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6877347879-13">[</span><span class="mi">4</span><span class="p" data-group-id="6877347879-13">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-14">[</span><span class="o">-</span><span class="mf">0.2961483597755432</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3721822202205658</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1726730614900589</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.20648165047168732</span><span class="p" data-group-id="6877347879-14">]</span><span class="w">
    </span><span class="p" data-group-id="6877347879-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-15">#</span><span class="nc" data-group-id="6877347879-15">Nx.Tensor</span><span class="p" data-group-id="6877347879-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6877347879-16">[</span><span class="mi">8</span><span class="p" data-group-id="6877347879-16">]</span><span class="p" data-group-id="6877347879-17">[</span><span class="mi">4</span><span class="p" data-group-id="6877347879-17">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-18">[</span><span class="w">
        </span><span class="p" data-group-id="6877347879-19">[</span><span class="mf">0.602420449256897</span><span class="p">,</span><span class="w"> </span><span class="mf">0.46551579236984253</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3295630216598511</span><span class="p">,</span><span class="w"> </span><span class="mf">0.484800785779953</span><span class="p" data-group-id="6877347879-19">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-20">[</span><span class="mf">0.05755739286541939</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2412092238664627</span><span class="p">,</span><span class="w"> </span><span class="mf">0.27874955534935</span><span class="p">,</span><span class="w"> </span><span class="mf">0.13457047939300537</span><span class="p" data-group-id="6877347879-20">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-21">[</span><span class="o">-</span><span class="mf">0.26997247338294983</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4479314386844635</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4976465106010437</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.05715075880289078</span><span class="p" data-group-id="6877347879-21">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-22">[</span><span class="o">-</span><span class="mf">0.7245721220970154</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1187945082783699</span><span class="p">,</span><span class="w"> </span><span class="mf">0.14330074191093445</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3257679343223572</span><span class="p" data-group-id="6877347879-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-23">[</span><span class="o">-</span><span class="mf">0.032964885234832764</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.625235915184021</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.05669135972857475</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.7016372680664062</span><span class="p" data-group-id="6877347879-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-24">[</span><span class="o">-</span><span class="mf">0.08433973789215088</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.07334757596254349</span><span class="p">,</span><span class="w"> </span><span class="mf">0.08273869007825851</span><span class="p">,</span><span class="w"> </span><span class="mf">0.46893611550331116</span><span class="p" data-group-id="6877347879-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-25">[</span><span class="mf">0.4123252332210541</span><span class="p">,</span><span class="w"> </span><span class="mf">0.9876810312271118</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3525731563568115</span><span class="p">,</span><span class="w"> </span><span class="mf">0.030163511633872986</span><span class="p" data-group-id="6877347879-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-26">[</span><span class="mf">0.6962482333183289</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5394620299339294</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6907036304473877</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5448697209358215</span><span class="p" data-group-id="6877347879-26">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-18">]</span><span class="w">
    </span><span class="p" data-group-id="6877347879-15">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6877347879-11">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-27">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-28">#</span><span class="nc" data-group-id="6877347879-28">Nx.Tensor</span><span class="p" data-group-id="6877347879-28">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6877347879-29">[</span><span class="mi">1</span><span class="p" data-group-id="6877347879-29">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-30">[</span><span class="mf">0.7519291043281555</span><span class="p" data-group-id="6877347879-30">]</span><span class="w">
    </span><span class="p" data-group-id="6877347879-28">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6877347879-31">#</span><span class="nc" data-group-id="6877347879-31">Nx.Tensor</span><span class="p" data-group-id="6877347879-31">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="6877347879-32">[</span><span class="mi">4</span><span class="p" data-group-id="6877347879-32">]</span><span class="p" data-group-id="6877347879-33">[</span><span class="mi">1</span><span class="p" data-group-id="6877347879-33">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-34">[</span><span class="w">
        </span><span class="p" data-group-id="6877347879-35">[</span><span class="mf">0.7839917540550232</span><span class="p" data-group-id="6877347879-35">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-36">[</span><span class="o">-</span><span class="mf">0.8586246967315674</span><span class="p" data-group-id="6877347879-36">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-37">[</span><span class="mf">0.8599083423614502</span><span class="p" data-group-id="6877347879-37">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6877347879-38">[</span><span class="mf">0.29766184091567993</span><span class="p" data-group-id="6877347879-38">]</span><span class="w">
      </span><span class="p" data-group-id="6877347879-34">]</span><span class="w">
    </span><span class="p" data-group-id="6877347879-31">&gt;</span><span class="w">
  </span><span class="p" data-group-id="6877347879-27">}</span><span class="w">
</span><span class="p" data-group-id="6877347879-1">}</span></code></pre><p>Running loops with <a href="Axon.Loop.html#trainer/3"><code class="inline">Axon.Loop.trainer/3</code></a> returns a trained model state which you can use to evaluate your model. To construct an evaluation loop, you just call <a href="Axon.Loop.html#evaluator/1"><code class="inline">Axon.Loop.evaluator/1</code></a> with your pre-trained model:</p><pre><code class="makeup elixir" translate="no"><span class="n">test_loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">evaluator</span><span class="p" data-group-id="9852526648-1">(</span><span class="n">model</span><span class="p" data-group-id="9852526648-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="1549608134-1">#</span><span class="nc" data-group-id="1549608134-1">Axon.Loop</span><span class="p" data-group-id="1549608134-1">&lt;</span><span class="w">
  </span><span class="ss">metrics</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-2">%{</span><span class="p" data-group-id="1549608134-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">handlers</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-3">%{</span><span class="w">
    </span><span class="ss">completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-4">[</span><span class="p" data-group-id="1549608134-4">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-5">[</span><span class="p" data-group-id="1549608134-5">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_halted</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-6">[</span><span class="p" data-group-id="1549608134-6">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-7">[</span><span class="p" data-group-id="1549608134-7">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">halted</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-8">[</span><span class="p" data-group-id="1549608134-8">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">iteration_completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-9">[</span><span class="w">
      </span><span class="p" data-group-id="1549608134-10">{</span><span class="p" data-group-id="1549608134-11">#</span><span class="nc" data-group-id="1549608134-11">Function</span><span class="p" data-group-id="1549608134-11">&lt;</span><span class="mf">27.37390314</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">log</span><span class="o">/</span><span class="mi">3</span><span class="p" data-group-id="1549608134-11">&gt;</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="1549608134-12">#</span><span class="nc" data-group-id="1549608134-12">Function</span><span class="p" data-group-id="1549608134-12">&lt;</span><span class="mf">6.37390314</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_filter_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="1549608134-12">&gt;</span><span class="p" data-group-id="1549608134-10">}</span><span class="w">
    </span><span class="p" data-group-id="1549608134-9">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">iteration_started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-13">[</span><span class="p" data-group-id="1549608134-13">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1549608134-14">[</span><span class="p" data-group-id="1549608134-14">]</span><span class="w">
  </span><span class="p" data-group-id="1549608134-3">}</span><span class="p">,</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="p" data-group-id="1549608134-1">&gt;</span></code></pre><p>Next, you'll need to instrument your test loop with the metrics you'd like to aggregate:</p><pre><code class="makeup elixir" translate="no"><span class="n">test_loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test_loop</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">metric</span><span class="p" data-group-id="6894016596-1">(</span><span class="ss">:mean_absolute_error</span><span class="p" data-group-id="6894016596-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="6830441854-1">#</span><span class="nc" data-group-id="6830441854-1">Axon.Loop</span><span class="p" data-group-id="6830441854-1">&lt;</span><span class="w">
  </span><span class="ss">metrics</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-2">%{</span><span class="w">
    </span><span class="s">&quot;mean_absolute_error&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="6830441854-3">{</span><span class="p" data-group-id="6830441854-4">#</span><span class="nc" data-group-id="6830441854-4">Function</span><span class="p" data-group-id="6830441854-4">&lt;</span><span class="mf">11.133813849</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Metrics</span><span class="o">.</span><span class="n">running_average</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="6830441854-4">&gt;</span><span class="p">,</span><span class="w">
     </span><span class="ss">:mean_absolute_error</span><span class="p" data-group-id="6830441854-3">}</span><span class="w">
  </span><span class="p" data-group-id="6830441854-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">handlers</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-5">%{</span><span class="w">
    </span><span class="ss">completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-6">[</span><span class="p" data-group-id="6830441854-6">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-7">[</span><span class="p" data-group-id="6830441854-7">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_halted</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-8">[</span><span class="p" data-group-id="6830441854-8">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-9">[</span><span class="p" data-group-id="6830441854-9">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">halted</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-10">[</span><span class="p" data-group-id="6830441854-10">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">iteration_completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-11">[</span><span class="w">
      </span><span class="p" data-group-id="6830441854-12">{</span><span class="p" data-group-id="6830441854-13">#</span><span class="nc" data-group-id="6830441854-13">Function</span><span class="p" data-group-id="6830441854-13">&lt;</span><span class="mf">27.37390314</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">log</span><span class="o">/</span><span class="mi">3</span><span class="p" data-group-id="6830441854-13">&gt;</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="6830441854-14">#</span><span class="nc" data-group-id="6830441854-14">Function</span><span class="p" data-group-id="6830441854-14">&lt;</span><span class="mf">6.37390314</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_filter_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="6830441854-14">&gt;</span><span class="p" data-group-id="6830441854-12">}</span><span class="w">
    </span><span class="p" data-group-id="6830441854-11">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">iteration_started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-15">[</span><span class="p" data-group-id="6830441854-15">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6830441854-16">[</span><span class="p" data-group-id="6830441854-16">]</span><span class="w">
  </span><span class="p" data-group-id="6830441854-5">}</span><span class="p">,</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="p" data-group-id="6830441854-1">&gt;</span></code></pre><p>Finally, you can run your loop on test data. Because you want to test your trained model, you need to provide your model's initial state to the test loop:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3978705807-1">(</span><span class="n">test_loop</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">trained_model_state</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p" data-group-id="3978705807-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">999</span><span class="p">,</span><span class="w"> </span><span class="ss">mean_absolute_error</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0856894</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="9588507503-1">%{</span><span class="w">
  </span><span class="mi">0</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9588507503-2">%{</span><span class="w">
    </span><span class="s">&quot;mean_absolute_error&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9588507503-3">#</span><span class="nc" data-group-id="9588507503-3">Nx.Tensor</span><span class="p" data-group-id="9588507503-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="w">
      </span><span class="mf">0.08568935841321945</span><span class="w">
    </span><span class="p" data-group-id="9588507503-3">&gt;</span><span class="w">
  </span><span class="p" data-group-id="9588507503-2">}</span><span class="w">
</span><span class="p" data-group-id="9588507503-1">}</span></code></pre>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="instrumenting_loops_with_metrics.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Instrumenting loops with metrics
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="using_loop_event_handlers.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Using loop event handlers
        </span>
      </a>

  </div>
</div>
      <footer class="footer">
        <p>

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.6.0" class="footer-hex-package">Hex Package</a>

              <a href="https://preview.hex.pm/preview/axon/0.6.0">Hex Preview</a>

                (<a href="https://preview.hex.pm/preview/axon/0.6.0/show/guides/training_and_evaluation/your_first_evaluation_loop.livemd">current file</a>)

            </span>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Axon.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.29.3) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>

<!-- Render math with KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ]
    });
  });
</script>

<!-- Render diagrams with Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({ startOnLoad: false });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition, function (svgSource, bindListeners) {
        graphEl.innerHTML = svgSource;
        bindListeners && bindListeners(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
