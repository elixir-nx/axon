<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.6">
    <meta name="project" content="Axon v0.3.0">

    <title>Accelerating Axon — Axon v0.3.0</title>
    <link rel="stylesheet" href="dist/html-elixir-5CLCQQME.css" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-X7YVL3G2.js"></script>
    <script src="dist/sidebar_items-CFEF4C15.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-PLW5RNNI.js"></script>


  </head>
  <body data-type="extras" class="page-livemd">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="Axon.html">
        <img src="assets/logo.png" alt="Axon" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.3.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/elixir-nx/axon/blob/v0.3.0/guides/model_execution/accelerating_axon.livemd#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span>Accelerating Axon</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="6168359968-1">(</span><span class="p" data-group-id="6168359968-2">[</span><span class="w">
  </span><span class="p" data-group-id="6168359968-3">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;elixir-nx/axon&quot;</span><span class="p" data-group-id="6168359968-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6168359968-4">{</span><span class="ss">:exla</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.3.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;elixir-nx/nx&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">sparse</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exla&quot;</span><span class="p" data-group-id="6168359968-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6168359968-5">{</span><span class="ss">:torchx</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;elixir-nx/nx&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">sparse</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;torchx&quot;</span><span class="p" data-group-id="6168359968-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6168359968-6">{</span><span class="ss">:nx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.3.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;elixir-nx/nx&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">sparse</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nx&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">override</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6168359968-6">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6168359968-7">{</span><span class="ss">:benchee</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;akoutmos/benchee&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">branch</span><span class="p">:</span><span class="w"> </span><span class="ss">:adding_table_support</span><span class="p" data-group-id="6168359968-7">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6168359968-8">{</span><span class="ss">:kino_benchee</span><span class="p">,</span><span class="w"> </span><span class="ss">github</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;livebook-dev/kino_benchee&quot;</span><span class="p" data-group-id="6168359968-8">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6168359968-9">{</span><span class="ss">:kino</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.7.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">override</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6168359968-9">}</span><span class="w">
</span><span class="p" data-group-id="6168359968-2">]</span><span class="p" data-group-id="6168359968-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">:ok</span></code></pre><h2 id="using-nx-compilers-in-axon" class="section-heading">
  <a href="#using-nx-compilers-in-axon" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">using-nx-compilers-in-axon</p>
  </a>
  Using Nx Compilers in Axon
</h2>
<p>Axon is built entirely on top of Nx's numerical definitions <code class="inline">defn</code>. Functions declared with <code class="inline">defn</code> tell Nx to use <em>just-in-time compilation</em> to compile and execute the given numerical definition with an available Nx compiler. Numerical definitions enable acceleration on CPU/GPU/TPU via pluggable compilers. At the time of this writing, Nx has 2 officially supported compiler/backends on top of the default <code class="inline">BinaryBackend</code>:</p><ol><li>EXLA - Acceleration via Google's <a href="https://www.tensorflow.org/xla">XLA project</a></li><li>TorchX - Bindings to <a href="https://pytorch.org/cppdocs/">LibTorch</a></li></ol><p>By default, Nx and Axon run all computations using the <code class="inline">BinaryBackend</code> which is a pure Elixir implementation of various numerical routines. The <code class="inline">BinaryBackend</code> is guaranteed to run wherever an Elixir installation runs; however, it is <strong>very</strong> slow. Due to the computational expense of neural networks, you should basically never use the <code class="inline">BinaryBackend</code> and instead opt for one of the available accelerated libraries.</p><p>There are several ways to make use of Nx compilers from within Axon. First, create a simple model for benchmarking purposes:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="1836351667-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="1836351667-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="1836351667-2">(</span><span class="mi">32</span><span class="p" data-group-id="1836351667-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="1836351667-3">(</span><span class="p" data-group-id="1836351667-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="1836351667-4">(</span><span class="mi">1</span><span class="p" data-group-id="1836351667-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">softmax</span><span class="p" data-group-id="1836351667-5">(</span><span class="p" data-group-id="1836351667-5">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="2347246645-1">#</span><span class="nc" data-group-id="2347246645-1">Axon</span><span class="p" data-group-id="2347246645-1">&lt;</span><span class="w">
  </span><span class="ss">inputs</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2347246645-2">%{</span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="2347246645-2">}</span><span class="w">
  </span><span class="ss">outputs</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;softmax_0&quot;</span><span class="w">
  </span><span class="ss">nodes</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span><span class="p" data-group-id="2347246645-1">&gt;</span></code></pre><p>By default, Axon will respect the default <code class="inline">defn</code> compilation options. You can set compilation options globally or per-process:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Sets the global compilation options</span><span class="w">
</span><span class="nc">Nx.Defn</span><span class="o">.</span><span class="n">global_default_options</span><span class="p" data-group-id="0977742225-1">(</span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="0977742225-1">)</span><span class="w">
</span><span class="c1"># Sets the process-level compilation options</span><span class="w">
</span><span class="nc">Nx.Defn</span><span class="o">.</span><span class="n">default_options</span><span class="p" data-group-id="0977742225-2">(</span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="0977742225-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="4507318345-1">[</span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="4507318345-1">]</span></code></pre><p>When you call <a href="Axon.html#build/2"><code class="inline">Axon.build/2</code></a>, Axon automatically marks your initialization and forward functions as JIT compiled functions. When you invoke them, they will compile a specialized version of the function using your default compiler options:</p><pre><code class="makeup elixir" translate="no"><span class="n">inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">random_uniform</span><span class="p" data-group-id="1912540589-1">(</span><span class="p" data-group-id="1912540589-2">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p" data-group-id="1912540589-2">}</span><span class="p" data-group-id="1912540589-1">)</span><span class="w">
</span><span class="p" data-group-id="1912540589-3">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="1912540589-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="1912540589-4">(</span><span class="n">model</span><span class="p" data-group-id="1912540589-4">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="1912540589-5">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1912540589-6">%{</span><span class="p" data-group-id="1912540589-6">}</span><span class="p" data-group-id="1912540589-5">)</span><span class="w">
</span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="1912540589-7">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="1912540589-7">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="w">
</span><span class="mi">10</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">02.503</span><span class="w"> </span><span class="p" data-group-id="0847885372-1">[</span><span class="n">info</span><span class="p" data-group-id="0847885372-1">]</span><span class="w">  </span><span class="nc">XLA</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="mh">0x7fbd5468c170</span><span class="w"> </span><span class="n">initialized</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="nc">Host</span><span class="w"> </span><span class="p" data-group-id="0847885372-2">(</span><span class="n">this</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">guarantee</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="nc">XLA</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="p" data-group-id="0847885372-2">)</span><span class="o">.</span><span class="w"> </span><span class="ss">Devices</span><span class="p">:</span><span class="w">

</span><span class="mi">10</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">02.785</span><span class="w"> </span><span class="p" data-group-id="0847885372-3">[</span><span class="n">info</span><span class="p" data-group-id="0847885372-3">]</span><span class="w">    </span><span class="nc">StreamExecutor</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="p" data-group-id="0847885372-4">(</span><span class="mi">0</span><span class="p" data-group-id="0847885372-4">)</span><span class="p">:</span><span class="w"> </span><span class="nc">Host</span><span class="p">,</span><span class="w"> </span><span class="nc">Default</span><span class="w"> </span><span class="nc">Version</span><span class="w">
</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="3927715801-1">#</span><span class="nc" data-group-id="3927715801-1">Nx.Tensor</span><span class="p" data-group-id="3927715801-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="3927715801-2">[</span><span class="mi">2</span><span class="p" data-group-id="3927715801-2">]</span><span class="p" data-group-id="3927715801-3">[</span><span class="mi">1</span><span class="p" data-group-id="3927715801-3">]</span><span class="w">
  </span><span class="nc">EXLA.Backend</span><span class="o">&lt;</span><span class="n">host</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.184501844</span><span class="o">.</span><span class="mf">1168769032.259095</span><span class="p" data-group-id="3927715801-1">&gt;</span><span class="w">
  </span><span class="p" data-group-id="3927715801-4">[</span><span class="w">
    </span><span class="p" data-group-id="3927715801-5">[</span><span class="mf">1.0</span><span class="p" data-group-id="3927715801-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3927715801-6">[</span><span class="mf">1.0</span><span class="p" data-group-id="3927715801-6">]</span><span class="w">
  </span><span class="p" data-group-id="3927715801-4">]</span><span class="w">
</span><span class="o">&gt;</span></code></pre><p>Notice that the inspected tensor indicates the computation has been dispatched to EXLA and the tensor's data points to an EXLA buffer.</p><p>If you feel like setting the global or process-level compilation options is too intrusive, you can opt for more explicit behavior in a few ways. First, you can specify the JIT compiler when you build the model:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Set back to defaults</span><span class="w">
</span><span class="nc">Nx.Defn</span><span class="o">.</span><span class="n">global_default_options</span><span class="p" data-group-id="2320520188-1">(</span><span class="p" data-group-id="2320520188-2">[</span><span class="p" data-group-id="2320520188-2">]</span><span class="p" data-group-id="2320520188-1">)</span><span class="w">
</span><span class="nc">Nx.Defn</span><span class="o">.</span><span class="n">default_options</span><span class="p" data-group-id="2320520188-3">(</span><span class="p" data-group-id="2320520188-4">[</span><span class="p" data-group-id="2320520188-4">]</span><span class="p" data-group-id="2320520188-3">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="3867826238-1">[</span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="3867826238-1">]</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="8600346291-1">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="8600346291-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="8600346291-2">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="8600346291-2">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="8600346291-3">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8600346291-4">%{</span><span class="p" data-group-id="8600346291-4">}</span><span class="p" data-group-id="8600346291-3">)</span><span class="w">
</span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="8600346291-5">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="8600346291-5">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0134511232-1">#</span><span class="nc" data-group-id="0134511232-1">Nx.Tensor</span><span class="p" data-group-id="0134511232-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="0134511232-2">[</span><span class="mi">2</span><span class="p" data-group-id="0134511232-2">]</span><span class="p" data-group-id="0134511232-3">[</span><span class="mi">1</span><span class="p" data-group-id="0134511232-3">]</span><span class="w">
  </span><span class="nc">EXLA.Backend</span><span class="o">&lt;</span><span class="n">host</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.184501844</span><span class="o">.</span><span class="mf">1168769032.259101</span><span class="p" data-group-id="0134511232-1">&gt;</span><span class="w">
  </span><span class="p" data-group-id="0134511232-4">[</span><span class="w">
    </span><span class="p" data-group-id="0134511232-5">[</span><span class="mf">1.0</span><span class="p" data-group-id="0134511232-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0134511232-6">[</span><span class="mf">1.0</span><span class="p" data-group-id="0134511232-6">]</span><span class="w">
  </span><span class="p" data-group-id="0134511232-4">]</span><span class="w">
</span><span class="o">&gt;</span></code></pre><p>You can also instead JIT compile functions explicitly via the <code class="inline">Nx.Defn.jit</code> or compiler-specific JIT APIs. This is useful when running benchmarks against various backends:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="1305820208-1">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="1305820208-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="1305820208-2">(</span><span class="n">model</span><span class="p" data-group-id="1305820208-2">)</span><span class="w">

</span><span class="c1"># These will both JIT compile with EXLA</span><span class="w">
</span><span class="n">exla_init_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx.Defn</span><span class="o">.</span><span class="n">jit</span><span class="p" data-group-id="1305820208-3">(</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="1305820208-3">)</span><span class="w">
</span><span class="n">exla_predict_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">EXLA</span><span class="o">.</span><span class="n">jit</span><span class="p" data-group-id="1305820208-4">(</span><span class="n">predict_fn</span><span class="p" data-group-id="1305820208-4">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0818493063-1">#</span><span class="nc" data-group-id="0818493063-1">Function</span><span class="p" data-group-id="0818493063-1">&lt;</span><span class="mf">136.40088443</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Nx.Defn</span><span class="o">.</span><span class="n">wrap_arity</span><span class="o">/</span><span class="mi">2</span><span class="p" data-group-id="0818493063-1">&gt;</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">Benchee</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8188143904-1">(</span><span class="w">
  </span><span class="p" data-group-id="8188143904-2">%{</span><span class="w">
    </span><span class="s">&quot;elixir init&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k" data-group-id="8188143904-3">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="8188143904-4">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8188143904-5">%{</span><span class="p" data-group-id="8188143904-5">}</span><span class="p" data-group-id="8188143904-4">)</span><span class="w"> </span><span class="k" data-group-id="8188143904-3">end</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;exla init&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k" data-group-id="8188143904-6">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">exla_init_fn</span><span class="o">.</span><span class="p" data-group-id="8188143904-7">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8188143904-8">%{</span><span class="p" data-group-id="8188143904-8">}</span><span class="p" data-group-id="8188143904-7">)</span><span class="w"> </span><span class="k" data-group-id="8188143904-6">end</span><span class="w">
  </span><span class="p" data-group-id="8188143904-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="ss">memory_time</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="ss">warmup</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p" data-group-id="8188143904-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evaluated</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w">
  </span><span class="nc">Evaluated</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">functions</span><span class="o">.</span><span class="w">
  </span><span class="nc">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">Benchee</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="nc">Mod</span><span class="o">.</span><span class="n">fun</span><span class="p" data-group-id="9873493629-1">(</span><span class="p" data-group-id="9873493629-1">)</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span><span class="w">
  </span><span class="nc">Alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w">

</span><span class="ss">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evaluated</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w">
  </span><span class="nc">Evaluated</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">functions</span><span class="o">.</span><span class="w">
  </span><span class="nc">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">Benchee</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="nc">Mod</span><span class="o">.</span><span class="n">fun</span><span class="p" data-group-id="9873493629-2">(</span><span class="p" data-group-id="9873493629-2">)</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span><span class="w">
  </span><span class="nc">Alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w">

</span><span class="nc">Operating</span><span class="w"> </span><span class="ss">System</span><span class="p">:</span><span class="w"> </span><span class="nc">Linux</span><span class="w">
</span><span class="nc">CPU</span><span class="w"> </span><span class="ss">Information</span><span class="p">:</span><span class="w"> </span><span class="nc">Intel</span><span class="p" data-group-id="9873493629-3">(</span><span class="nc">R</span><span class="p" data-group-id="9873493629-3">)</span><span class="w"> </span><span class="nc">Core</span><span class="p" data-group-id="9873493629-4">(</span><span class="nc">TM</span><span class="p" data-group-id="9873493629-4">)</span><span class="w"> </span><span class="n">i7</span><span class="o">-</span><span class="mi">7600</span><span class="nc">U</span><span class="w"> </span><span class="nc">CPU</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="mf">2.80</span><span class="nc">GHz</span><span class="w">
</span><span class="nc">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nc">Available</span><span class="w"> </span><span class="ss">Cores</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="nc">Available</span><span class="w"> </span><span class="ss">memory</span><span class="p">:</span><span class="w"> </span><span class="mf">24.95</span><span class="w"> </span><span class="nc">GB</span><span class="w">
</span><span class="nc">Elixir</span><span class="w"> </span><span class="mf">1.13</span><span class="o">.</span><span class="mi">4</span><span class="w">
</span><span class="nc">Erlang</span><span class="w"> </span><span class="mf">25.0</span><span class="o">.</span><span class="mi">4</span><span class="w">

</span><span class="nc">Benchmark</span><span class="w"> </span><span class="n">suite</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="ss">configuration</span><span class="p">:</span><span class="w">
</span><span class="ss">warmup</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="n">memory</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="n">reduction</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">ns</span><span class="w">
</span><span class="ss">parallel</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ss">inputs</span><span class="p">:</span><span class="w"> </span><span class="n">none</span><span class="w"> </span><span class="n">specified</span><span class="w">
</span><span class="nc">Estimated</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="n">s</span><span class="w">

</span><span class="nc">Benchmarking</span><span class="w"> </span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">...</span><span class="w">
</span><span class="nc">Benchmarking</span><span class="w"> </span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">...</span><span class="w">

</span><span class="nc">Name</span><span class="w">                  </span><span class="n">ips</span><span class="w">        </span><span class="n">average</span><span class="w">  </span><span class="n">deviation</span><span class="w">         </span><span class="n">median</span><span class="w">         </span><span class="mi">99</span><span class="n">th</span><span class="w"> </span><span class="p">%</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w">          </span><span class="mf">3.79</span><span class="w"> </span><span class="nc">K</span><span class="w">        </span><span class="mf">0.26</span><span class="w"> </span><span class="n">ms</span><span class="w">   </span><span class="err">±</span><span class="mf">100.40</span><span class="p">%</span><span class="w">        </span><span class="mf">0.24</span><span class="w"> </span><span class="n">ms</span><span class="w">        </span><span class="mf">0.97</span><span class="w"> </span><span class="n">ms</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w">        </span><span class="mf">0.52</span><span class="w"> </span><span class="nc">K</span><span class="w">        </span><span class="mf">1.91</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="err">±</span><span class="mf">35.03</span><span class="p">%</span><span class="w">        </span><span class="mf">1.72</span><span class="w"> </span><span class="n">ms</span><span class="w">        </span><span class="mf">3.72</span><span class="w"> </span><span class="n">ms</span><span class="w">

</span><span class="ss">Comparison</span><span class="p">:</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w">          </span><span class="mf">3.79</span><span class="w"> </span><span class="nc">K</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w">        </span><span class="mf">0.52</span><span class="w"> </span><span class="nc">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">7.25</span><span class="n">x</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="o">+</span><span class="mf">1.65</span><span class="w"> </span><span class="n">ms</span><span class="w">

</span><span class="nc">Memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="ss">statistics</span><span class="p">:</span><span class="w">

</span><span class="nc">Name</span><span class="w">           </span><span class="nc">Memory</span><span class="w"> </span><span class="n">usage</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w">           </span><span class="mf">9.80</span><span class="w"> </span><span class="nc">KB</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w">       </span><span class="mf">644.63</span><span class="w"> </span><span class="nc">KB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">65.80</span><span class="n">x</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="o">+</span><span class="mf">634.83</span><span class="w"> </span><span class="nc">KB</span><span class="w">

</span><span class="o">*</span><span class="o">*</span><span class="nc">All</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="o">*</span><span class="o">*</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">Benchee</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6718792507-1">(</span><span class="w">
  </span><span class="p" data-group-id="6718792507-2">%{</span><span class="w">
    </span><span class="s">&quot;elixir predict&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k" data-group-id="6718792507-3">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="6718792507-4">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="6718792507-4">)</span><span class="w"> </span><span class="k" data-group-id="6718792507-3">end</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;exla predict&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k" data-group-id="6718792507-5">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">exla_predict_fn</span><span class="o">.</span><span class="p" data-group-id="6718792507-6">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="6718792507-6">)</span><span class="w"> </span><span class="k" data-group-id="6718792507-5">end</span><span class="w">
  </span><span class="p" data-group-id="6718792507-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="ss">memory_time</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="ss">warmup</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p" data-group-id="6718792507-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evaluated</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w">
  </span><span class="nc">Evaluated</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">functions</span><span class="o">.</span><span class="w">
  </span><span class="nc">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">Benchee</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="nc">Mod</span><span class="o">.</span><span class="n">fun</span><span class="p" data-group-id="4024892077-1">(</span><span class="p" data-group-id="4024892077-1">)</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span><span class="w">
  </span><span class="nc">Alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w">

</span><span class="ss">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evaluated</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w">
  </span><span class="nc">Evaluated</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">functions</span><span class="o">.</span><span class="w">
  </span><span class="nc">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">Benchee</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="nc">Mod</span><span class="o">.</span><span class="n">fun</span><span class="p" data-group-id="4024892077-2">(</span><span class="p" data-group-id="4024892077-2">)</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span><span class="w">
  </span><span class="nc">Alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w">

</span><span class="nc">Operating</span><span class="w"> </span><span class="ss">System</span><span class="p">:</span><span class="w"> </span><span class="nc">Linux</span><span class="w">
</span><span class="nc">CPU</span><span class="w"> </span><span class="ss">Information</span><span class="p">:</span><span class="w"> </span><span class="nc">Intel</span><span class="p" data-group-id="4024892077-3">(</span><span class="nc">R</span><span class="p" data-group-id="4024892077-3">)</span><span class="w"> </span><span class="nc">Core</span><span class="p" data-group-id="4024892077-4">(</span><span class="nc">TM</span><span class="p" data-group-id="4024892077-4">)</span><span class="w"> </span><span class="n">i7</span><span class="o">-</span><span class="mi">7600</span><span class="nc">U</span><span class="w"> </span><span class="nc">CPU</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="mf">2.80</span><span class="nc">GHz</span><span class="w">
</span><span class="nc">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nc">Available</span><span class="w"> </span><span class="ss">Cores</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="nc">Available</span><span class="w"> </span><span class="ss">memory</span><span class="p">:</span><span class="w"> </span><span class="mf">24.95</span><span class="w"> </span><span class="nc">GB</span><span class="w">
</span><span class="nc">Elixir</span><span class="w"> </span><span class="mf">1.13</span><span class="o">.</span><span class="mi">4</span><span class="w">
</span><span class="nc">Erlang</span><span class="w"> </span><span class="mf">25.0</span><span class="o">.</span><span class="mi">4</span><span class="w">

</span><span class="nc">Benchmark</span><span class="w"> </span><span class="n">suite</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="ss">configuration</span><span class="p">:</span><span class="w">
</span><span class="ss">warmup</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="n">memory</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="n">reduction</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">ns</span><span class="w">
</span><span class="ss">parallel</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ss">inputs</span><span class="p">:</span><span class="w"> </span><span class="n">none</span><span class="w"> </span><span class="n">specified</span><span class="w">
</span><span class="nc">Estimated</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="n">s</span><span class="w">

</span><span class="nc">Benchmarking</span><span class="w"> </span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w"> </span><span class="n">...</span><span class="w">
</span><span class="nc">Benchmarking</span><span class="w"> </span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w"> </span><span class="n">...</span><span class="w">

</span><span class="nc">Name</span><span class="w">                     </span><span class="n">ips</span><span class="w">        </span><span class="n">average</span><span class="w">  </span><span class="n">deviation</span><span class="w">         </span><span class="n">median</span><span class="w">         </span><span class="mi">99</span><span class="n">th</span><span class="w"> </span><span class="p">%</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w">          </span><span class="mf">2.32</span><span class="w"> </span><span class="nc">K</span><span class="w">        </span><span class="mf">0.43</span><span class="w"> </span><span class="n">ms</span><span class="w">   </span><span class="err">±</span><span class="mf">147.05</span><span class="p">%</span><span class="w">        </span><span class="mf">0.34</span><span class="w"> </span><span class="n">ms</span><span class="w">        </span><span class="mf">1.61</span><span class="w"> </span><span class="n">ms</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w">        </span><span class="mf">0.28</span><span class="w"> </span><span class="nc">K</span><span class="w">        </span><span class="mf">3.53</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="err">±</span><span class="mf">42.21</span><span class="p">%</span><span class="w">        </span><span class="mf">3.11</span><span class="w"> </span><span class="n">ms</span><span class="w">        </span><span class="mf">7.26</span><span class="w"> </span><span class="n">ms</span><span class="w">

</span><span class="ss">Comparison</span><span class="p">:</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w">          </span><span class="mf">2.32</span><span class="w"> </span><span class="nc">K</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w">        </span><span class="mf">0.28</span><span class="w"> </span><span class="nc">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">8.20</span><span class="n">x</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="o">+</span><span class="mf">3.10</span><span class="w"> </span><span class="n">ms</span><span class="w">

</span><span class="nc">Memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="ss">statistics</span><span class="p">:</span><span class="w">

</span><span class="nc">Name</span><span class="w">              </span><span class="nc">Memory</span><span class="w"> </span><span class="n">usage</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w">          </span><span class="mf">10.95</span><span class="w"> </span><span class="nc">KB</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w">        </span><span class="mf">91.09</span><span class="w"> </span><span class="nc">KB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">8.32</span><span class="n">x</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="o">+</span><span class="mf">80.14</span><span class="w"> </span><span class="nc">KB</span><span class="w">

</span><span class="o">*</span><span class="o">*</span><span class="nc">All</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="o">*</span><span class="o">*</span></code></pre><p>Notice how calls to EXLA variants are significantly faster than their Elixir counterparts. These speedups become more pronounced with more complex models and workflows.</p><p>It's important to note that in order to use a given library as an Nx compiler, it must implement the Nx compilation behaviour. For example, you cannot invoke Torchx as an Nx compiler because it does not support JIT compilation at this time.</p><h2 id="using-nx-backends-in-axon" class="section-heading">
  <a href="#using-nx-backends-in-axon" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">using-nx-backends-in-axon</p>
  </a>
  Using Nx Backends in Axon
</h2>
<p>In addition to JIT-compilation, Axon also supports the usage of Nx backends. Nx backends are slightly different than Nx compilers in the sense that they do not fuse calls within numerical definitions. Backends are more eager, sacrificing a bit of performance for convenience. Torchx and EXLA both support running via backends.</p><p>Again, Axon will respect the global and process-level Nx backend configuration options. You can set the default backend using:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Global default backend</span><span class="w">
</span><span class="nc">Nx</span><span class="o">.</span><span class="n">global_default_backend</span><span class="p" data-group-id="7677119889-1">(</span><span class="nc">Torchx.Backend</span><span class="p" data-group-id="7677119889-1">)</span><span class="w">
</span><span class="c1"># Process default backend</span><span class="w">
</span><span class="nc">Nx</span><span class="o">.</span><span class="n">default_backend</span><span class="p" data-group-id="7677119889-2">(</span><span class="nc">Torchx.Backend</span><span class="p" data-group-id="7677119889-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="8141154041-1">{</span><span class="nc">Nx.BinaryBackend</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8141154041-2">[</span><span class="p" data-group-id="8141154041-2">]</span><span class="p" data-group-id="8141154041-1">}</span></code></pre><p>Now when you invoke model functions, it will run them with the given backend:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="2648265909-1">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="2648265909-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="2648265909-2">(</span><span class="n">model</span><span class="p" data-group-id="2648265909-2">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="2648265909-3">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2648265909-4">%{</span><span class="p" data-group-id="2648265909-4">}</span><span class="p" data-group-id="2648265909-3">)</span><span class="w">
</span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="2648265909-5">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="2648265909-5">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="8523369181-1">#</span><span class="nc" data-group-id="8523369181-1">Nx.Tensor</span><span class="p" data-group-id="8523369181-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="8523369181-2">[</span><span class="mi">2</span><span class="p" data-group-id="8523369181-2">]</span><span class="p" data-group-id="8523369181-3">[</span><span class="mi">1</span><span class="p" data-group-id="8523369181-3">]</span><span class="w">
  </span><span class="nc">Torchx.Backend</span><span class="p" data-group-id="8523369181-4">(</span><span class="n">cpu</span><span class="p" data-group-id="8523369181-4">)</span><span class="w">
  </span><span class="p" data-group-id="8523369181-5">[</span><span class="w">
    </span><span class="p" data-group-id="8523369181-6">[</span><span class="mf">1.0</span><span class="p" data-group-id="8523369181-6">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="8523369181-7">[</span><span class="mf">1.0</span><span class="p" data-group-id="8523369181-7">]</span><span class="w">
  </span><span class="p" data-group-id="8523369181-5">]</span><span class="w">
</span><span class="p" data-group-id="8523369181-1">&gt;</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Global default backend</span><span class="w">
</span><span class="nc">Nx</span><span class="o">.</span><span class="n">global_default_backend</span><span class="p" data-group-id="4182420511-1">(</span><span class="nc">EXLA.Backend</span><span class="p" data-group-id="4182420511-1">)</span><span class="w">
</span><span class="c1"># Process default backend</span><span class="w">
</span><span class="nc">Nx</span><span class="o">.</span><span class="n">default_backend</span><span class="p" data-group-id="4182420511-2">(</span><span class="nc">EXLA.Backend</span><span class="p" data-group-id="4182420511-2">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0319945610-1">{</span><span class="nc">Torchx.Backend</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0319945610-2">[</span><span class="p" data-group-id="0319945610-2">]</span><span class="p" data-group-id="0319945610-1">}</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="5981323475-1">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="5981323475-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="5981323475-2">(</span><span class="n">model</span><span class="p" data-group-id="5981323475-2">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="5981323475-3">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5981323475-4">%{</span><span class="p" data-group-id="5981323475-4">}</span><span class="p" data-group-id="5981323475-3">)</span><span class="w">
</span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="5981323475-5">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="5981323475-5">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="1941405439-1">#</span><span class="nc" data-group-id="1941405439-1">Nx.Tensor</span><span class="p" data-group-id="1941405439-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="1941405439-2">[</span><span class="mi">2</span><span class="p" data-group-id="1941405439-2">]</span><span class="p" data-group-id="1941405439-3">[</span><span class="mi">1</span><span class="p" data-group-id="1941405439-3">]</span><span class="w">
  </span><span class="nc">EXLA.Backend</span><span class="o">&lt;</span><span class="n">host</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.184501844</span><span class="o">.</span><span class="mf">1169293320.110725</span><span class="p" data-group-id="1941405439-1">&gt;</span><span class="w">
  </span><span class="p" data-group-id="1941405439-4">[</span><span class="w">
    </span><span class="p" data-group-id="1941405439-5">[</span><span class="mf">1.0</span><span class="p" data-group-id="1941405439-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="1941405439-6">[</span><span class="mf">1.0</span><span class="p" data-group-id="1941405439-6">]</span><span class="w">
  </span><span class="p" data-group-id="1941405439-4">]</span><span class="w">
</span><span class="o">&gt;</span></code></pre><p>Unlike with JIT-compilation, you must set the backend at the top-level in order to invoke it. You should be careful using multiple backends in the same project as attempting to mix tensors between backends may result in strange performance bugs or errors.</p><p>With most larger models, using a JIT compiler will be more performant than using a backend.</p><h2 id="a-note-on-cpus-gpus-tpus" class="section-heading">
  <a href="#a-note-on-cpus-gpus-tpus" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">a-note-on-cpus-gpus-tpus</p>
  </a>
  A Note on CPUs/GPUs/TPUs
</h2>
<p>While Nx mostly tries to standardize behavior across compilers and backends, some behaviors are backend-specific. For example, the API for choosing an acceleration platform (e.g. CUDA/ROCm/TPU) is backend-specific. You should refer to your chosen compiler or backend's documentation for information on targeting various accelerators. Typically, you only need to change a few configuration options and your code will run as-is on a chosen accelerator.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="model_hooks.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Model hooks
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="training_and_inference_mode.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Training and inference mode
        </span>
      </a>

  </div>
</div>
      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.3.0" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/axon/0.3.0" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/axon/0.3.0/show/guides/model_execution/accelerating_axon.livemd">(current file)</a>

            </span>

            <button class="a-main line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.6) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>

<!-- Render math with KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ]
    });
  });
</script>

<!-- Render diagrams with Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({ startOnLoad: false });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition, function (svgSource, bindListeners) {
        graphEl.innerHTML = svgSource;
        bindListeners && bindListeners(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
