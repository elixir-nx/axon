<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.31.1">
    <meta name="project" content="Axon v0.6.1">


    <title>Accelerating Axon — Axon v0.6.1</title>
    <link rel="stylesheet" href="dist/html-elixir-FM2CSD74.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-43PMFBC7.js"></script>
    <script src="dist/sidebar_items-496153D3.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-L4O5OK2K.js"></script>


  </head>
  <body data-type="extras" class="page-livemd">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<div class="background-layer"></div>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="Axon.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Axon" />
        </a>

      <div>
        <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.6.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">
      <div class="top-search">
        <div class="search-settings">
          <form class="search-bar" action="search.html">
            <label class="search-label">
              <span class="sr-only">Search documentation of Axon</span>
              <input name="q" type="text" class="search-input" placeholder="Search Documentation (press /)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            </label>
            <button type="submit" class="search-button" aria-label="Submit Search">
              <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
            </button>
            <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
              <i class="ri-close-line ri-lg" title="Cancel search"></i>
            </button>
          </form>
          <div class="autocomplete">
          </div>
          <button class="icon-settings display-settings">
            <i class="ri-settings-3-line"></i>
            <span class="sr-only">Settings</span>
          </button>
        </div>

      </div>

<h1>

    <a href="https://github.com/elixir-nx/axon/blob/v0.6.1/guides/model_execution/accelerating_axon.livemd#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>


  <span>Accelerating Axon</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="1752545103-1">(</span><span class="p" data-group-id="1752545103-2">[</span><span class="w">
  </span><span class="p" data-group-id="1752545103-3">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;= 0.5.0&quot;</span><span class="p" data-group-id="1752545103-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="1752545103-4">{</span><span class="ss">:exla</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;= 0.5.0&quot;</span><span class="p" data-group-id="1752545103-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="1752545103-5">{</span><span class="ss">:torchx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;= 0.5.0&quot;</span><span class="p" data-group-id="1752545103-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="1752545103-6">{</span><span class="ss">:benchee</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 1.1&quot;</span><span class="p" data-group-id="1752545103-6">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="1752545103-7">{</span><span class="ss">:kino</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;= 0.9.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">override</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="1752545103-7">}</span><span class="w">
</span><span class="p" data-group-id="1752545103-2">]</span><span class="p" data-group-id="1752545103-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">:ok</span></code></pre><h2 id="using-nx-backends-in-axon" class="section-heading">
  <a href="#using-nx-backends-in-axon" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Using Nx Backends in Axon</span>
</h2>
<p>Nx provides two mechanisms for accelerating your neural networks: backends and compilers. Before we learn how to effectively use them, first let's create a simple model for benchmarking purposes:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="4842756138-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="4842756138-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="4842756138-2">(</span><span class="mi">32</span><span class="p" data-group-id="4842756138-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="4842756138-3">(</span><span class="p" data-group-id="4842756138-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="4842756138-4">(</span><span class="mi">1</span><span class="p" data-group-id="4842756138-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">softmax</span><span class="p" data-group-id="4842756138-5">(</span><span class="p" data-group-id="4842756138-5">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="5993884365-1">#</span><span class="nc" data-group-id="5993884365-1">Axon</span><span class="p" data-group-id="5993884365-1">&lt;</span><span class="w">
  </span><span class="ss">inputs</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5993884365-2">%{</span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="no">nil</span><span class="p" data-group-id="5993884365-2">}</span><span class="w">
  </span><span class="ss">outputs</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;softmax_0&quot;</span><span class="w">
  </span><span class="ss">nodes</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span><span class="p" data-group-id="5993884365-1">&gt;</span></code></pre><p>Backends are where your tensors (your neural network inputs and parameters) are located. By default, Nx and Axon run all computations using the <a href="https://hexdocs.pm/nx/0.7.0/Nx.BinaryBackend.html"><code class="inline">Nx.BinaryBackend</code></a> which is a pure Elixir implementation of various numerical routines. The <a href="https://hexdocs.pm/nx/0.7.0/Nx.BinaryBackend.html"><code class="inline">Nx.BinaryBackend</code></a> is guaranteed to run wherever an Elixir installation runs; however, it is <strong>very</strong> slow. Due to the computational expense of neural networks, you should basically never use the <a href="https://hexdocs.pm/nx/0.7.0/Nx.BinaryBackend.html"><code class="inline">Nx.BinaryBackend</code></a> and instead opt for one of the available accelerated libraries. At the time of writing, Nx officially supports two of them:</p><ol><li>EXLA - Acceleration via Google's <a href="https://www.tensorflow.org/xla">XLA project</a></li><li>TorchX - Bindings to <a href="https://pytorch.org/cppdocs/">LibTorch</a></li></ol><p>Axon will respect the global and process-level Nx backend configuration. Compilers are covered more in-depth in the second half of this example. You can set the default backend using the following APIs:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Sets the global compilation options (for all Elixir processes)</span><span class="w">
</span><span class="nc">Nx</span><span class="o">.</span><span class="n">global_default_backend</span><span class="p" data-group-id="8225364089-1">(</span><span class="nc">Torchx.Backend</span><span class="p" data-group-id="8225364089-1">)</span><span class="w">
</span><span class="c1"># OR</span><span class="w">
</span><span class="nc">Nx</span><span class="o">.</span><span class="n">global_default_backend</span><span class="p" data-group-id="8225364089-2">(</span><span class="nc">EXLA.Backend</span><span class="p" data-group-id="8225364089-2">)</span><span class="w">

</span><span class="c1"># Sets the process-level compilation options (current process only)</span><span class="w">
</span><span class="nc">Nx</span><span class="o">.</span><span class="n">default_backend</span><span class="p" data-group-id="8225364089-3">(</span><span class="nc">Torchx.Backend</span><span class="p" data-group-id="8225364089-3">)</span><span class="w">
</span><span class="c1"># OR</span><span class="w">
</span><span class="nc">Nx</span><span class="o">.</span><span class="n">default_backend</span><span class="p" data-group-id="8225364089-4">(</span><span class="nc">EXLA.Backend</span><span class="p" data-group-id="8225364089-4">)</span></code></pre><p>Now all tensors and operations on them will run on the configured backend:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="7890543539-1">{</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="c">_next_key</span><span class="p" data-group-id="7890543539-1">}</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Nx.Random</span><span class="o">.</span><span class="n">key</span><span class="p" data-group-id="7890543539-2">(</span><span class="mi">9999</span><span class="p" data-group-id="7890543539-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx.Random</span><span class="o">.</span><span class="n">uniform</span><span class="p" data-group-id="7890543539-3">(</span><span class="ss">shape</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7890543539-4">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p" data-group-id="7890543539-4">}</span><span class="p" data-group-id="7890543539-3">)</span><span class="w">

</span><span class="p" data-group-id="7890543539-5">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="7890543539-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="7890543539-6">(</span><span class="n">model</span><span class="p" data-group-id="7890543539-6">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="7890543539-7">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7890543539-8">%{</span><span class="p" data-group-id="7890543539-8">}</span><span class="p" data-group-id="7890543539-7">)</span><span class="w">
</span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="7890543539-9">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="7890543539-9">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="5466929975-1">#</span><span class="nc" data-group-id="5466929975-1">Nx.Tensor</span><span class="p" data-group-id="5466929975-1">&lt;</span><span class="w">
  </span><span class="nc">EXLA.Backend</span><span class="o">&lt;</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3278685746</span><span class="o">.</span><span class="mf">4275961901.179470</span><span class="p" data-group-id="5466929975-1">&gt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="5466929975-2">[</span><span class="mi">2</span><span class="p" data-group-id="5466929975-2">]</span><span class="p" data-group-id="5466929975-3">[</span><span class="mi">1</span><span class="p" data-group-id="5466929975-3">]</span><span class="w">
  </span><span class="p" data-group-id="5466929975-4">[</span><span class="w">
    </span><span class="p" data-group-id="5466929975-5">[</span><span class="mf">1.0</span><span class="p" data-group-id="5466929975-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5466929975-6">[</span><span class="mf">1.0</span><span class="p" data-group-id="5466929975-6">]</span><span class="w">
  </span><span class="p" data-group-id="5466929975-4">]</span><span class="w">
</span><span class="o">&gt;</span></code></pre><p>As you swap backends above, you will get tensors allocated on different backends as results. You should be careful using multiple backends in the same project as attempting to mix tensors between backends may result in strange performance bugs or errors, as Nx will require you to explicitly convert between backends.</p><p>With most larger models, using a compiler will bring more performance benefits in addition to the backend.</p><h2 id="using-nx-compilers-in-axon" class="section-heading">
  <a href="#using-nx-compilers-in-axon" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Using Nx Compilers in Axon</span>
</h2>
<p>Axon is built entirely on top of Nx's numerical definitions <code class="inline">defn</code>. Functions declared with <code class="inline">defn</code> tell Nx to use <em>just-in-time compilation</em> to compile and execute the given numerical definition with an available Nx compiler. Numerical definitions enable acceleration on CPU/GPU/TPU via pluggable compilers. At the time of this writing, only EXLA supports a compiler in addition to its backend.</p><p>When you call <a href="Axon.html#build/2"><code class="inline">Axon.build/2</code></a>, Axon can automatically mark your initialization and forward functions as JIT compiled functions. First let's make sure we are using the EXLA backend:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Nx</span><span class="o">.</span><span class="n">default_backend</span><span class="p" data-group-id="8555649831-1">(</span><span class="nc">EXLA.Backend</span><span class="p" data-group-id="8555649831-1">)</span></code></pre><p>And now let's build another model, this time passing the EXLA compiler as an option:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="4922843477-1">{</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="c">_next_key</span><span class="p" data-group-id="4922843477-1">}</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Nx.Random</span><span class="o">.</span><span class="n">key</span><span class="p" data-group-id="4922843477-2">(</span><span class="mi">9999</span><span class="p" data-group-id="4922843477-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx.Random</span><span class="o">.</span><span class="n">uniform</span><span class="p" data-group-id="4922843477-3">(</span><span class="ss">shape</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4922843477-4">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">128</span><span class="p" data-group-id="4922843477-4">}</span><span class="p" data-group-id="4922843477-3">)</span><span class="w">

</span><span class="p" data-group-id="4922843477-5">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="4922843477-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="4922843477-6">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="4922843477-6">)</span><span class="w">
</span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="4922843477-7">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4922843477-8">%{</span><span class="p" data-group-id="4922843477-8">}</span><span class="p" data-group-id="4922843477-7">)</span><span class="w">
</span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="4922843477-9">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="4922843477-9">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="w">
</span><span class="mi">15</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">26.463</span><span class="w"> </span><span class="p" data-group-id="2799735037-1">[</span><span class="n">info</span><span class="p" data-group-id="2799735037-1">]</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="nc">NUMA</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="nc">SysFS</span><span class="w"> </span><span class="n">had</span><span class="w"> </span><span class="n">negative</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p" data-group-id="2799735037-2">(</span><span class="o">-</span><span class="mi">1</span><span class="p" data-group-id="2799735037-2">)</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="nc">NUMA</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">returning</span><span class="w"> </span><span class="nc">NUMA</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">zero</span><span class="w">

</span><span class="mi">15</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">26.473</span><span class="w"> </span><span class="p" data-group-id="2799735037-3">[</span><span class="n">info</span><span class="p" data-group-id="2799735037-3">]</span><span class="w"> </span><span class="nc">XLA</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="mh">0x7f3488329030</span><span class="w"> </span><span class="n">initialized</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="nc">CUDA</span><span class="w"> </span><span class="p" data-group-id="2799735037-4">(</span><span class="n">this</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">guarantee</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="nc">XLA</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="p" data-group-id="2799735037-4">)</span><span class="o">.</span><span class="w"> </span><span class="ss">Devices</span><span class="p">:</span><span class="w">

</span><span class="mi">15</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">26.473</span><span class="w"> </span><span class="p" data-group-id="2799735037-5">[</span><span class="n">info</span><span class="p" data-group-id="2799735037-5">]</span><span class="w">   </span><span class="nc">StreamExecutor</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="p" data-group-id="2799735037-6">(</span><span class="mi">0</span><span class="p" data-group-id="2799735037-6">)</span><span class="p">:</span><span class="w"> </span><span class="nc">NVIDIA</span><span class="w"> </span><span class="nc">GeForce</span><span class="w"> </span><span class="nc">RTX</span><span class="w"> </span><span class="mi">3050</span><span class="w"> </span><span class="nc">Ti</span><span class="w"> </span><span class="nc">Laptop</span><span class="w"> </span><span class="nc">GPU</span><span class="p">,</span><span class="w"> </span><span class="nc">Compute</span><span class="w"> </span><span class="nc">Capability</span><span class="w"> </span><span class="mf">8.6</span><span class="w">

</span><span class="mi">15</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">26.473</span><span class="w"> </span><span class="p" data-group-id="2799735037-7">[</span><span class="n">info</span><span class="p" data-group-id="2799735037-7">]</span><span class="w"> </span><span class="nc">Using</span><span class="w"> </span><span class="nc">BFC</span><span class="w"> </span><span class="n">allocator</span><span class="o">.</span><span class="w">

</span><span class="mi">15</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">26.473</span><span class="w"> </span><span class="p" data-group-id="2799735037-8">[</span><span class="n">info</span><span class="p" data-group-id="2799735037-8">]</span><span class="w"> </span><span class="nc">XLA</span><span class="w"> </span><span class="n">backend</span><span class="w"> </span><span class="n">allocating</span><span class="w"> </span><span class="mi">3605004288</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nc">BFCAllocator</span><span class="o">.</span><span class="w">

</span><span class="mi">15</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mf">28.272</span><span class="w"> </span><span class="p" data-group-id="2799735037-9">[</span><span class="n">info</span><span class="p" data-group-id="2799735037-9">]</span><span class="w"> </span><span class="nc">TensorFloat</span><span class="o">-</span><span class="mi">32</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">matrix</span><span class="w"> </span><span class="n">multiplication</span><span class="o">.</span><span class="w"> </span><span class="nc">This</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">logged</span><span class="w"> </span><span class="n">once</span><span class="o">.</span><span class="w">
</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0693237894-1">#</span><span class="nc" data-group-id="0693237894-1">Nx.Tensor</span><span class="p" data-group-id="0693237894-1">&lt;</span><span class="w">
  </span><span class="n">f32</span><span class="p" data-group-id="0693237894-2">[</span><span class="mi">2</span><span class="p" data-group-id="0693237894-2">]</span><span class="p" data-group-id="0693237894-3">[</span><span class="mi">1</span><span class="p" data-group-id="0693237894-3">]</span><span class="w">
  </span><span class="nc">EXLA.Backend</span><span class="o">&lt;</span><span class="n">cuda</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3278685746</span><span class="o">.</span><span class="mf">4275699756.253533</span><span class="p" data-group-id="0693237894-1">&gt;</span><span class="w">
  </span><span class="p" data-group-id="0693237894-4">[</span><span class="w">
    </span><span class="p" data-group-id="0693237894-5">[</span><span class="mf">1.0</span><span class="p" data-group-id="0693237894-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0693237894-6">[</span><span class="mf">1.0</span><span class="p" data-group-id="0693237894-6">]</span><span class="w">
  </span><span class="p" data-group-id="0693237894-4">]</span><span class="w">
</span><span class="o">&gt;</span></code></pre><p>You can also instead JIT compile functions explicitly via the <code class="inline">Nx.Defn.jit</code> or compiler-specific JIT APIs. This is useful when running benchmarks against various backends:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="5017489920-1">{</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="n">predict_fn</span><span class="p" data-group-id="5017489920-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">build</span><span class="p" data-group-id="5017489920-2">(</span><span class="n">model</span><span class="p" data-group-id="5017489920-2">)</span><span class="w">

</span><span class="c1"># These will both JIT compile with EXLA</span><span class="w">
</span><span class="n">exla_init_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx.Defn</span><span class="o">.</span><span class="n">jit</span><span class="p" data-group-id="5017489920-3">(</span><span class="n">init_fn</span><span class="p">,</span><span class="w"> </span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="5017489920-3">)</span><span class="w">
</span><span class="n">exla_predict_fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">EXLA</span><span class="o">.</span><span class="n">jit</span><span class="p" data-group-id="5017489920-4">(</span><span class="n">predict_fn</span><span class="p" data-group-id="5017489920-4">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="3611346653-1">#</span><span class="nc" data-group-id="3611346653-1">Function</span><span class="p" data-group-id="3611346653-1">&lt;</span><span class="mf">135.109794929</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Nx.Defn.Compiler</span><span class="o">.</span><span class="n">fun</span><span class="o">/</span><span class="mi">2</span><span class="p" data-group-id="3611346653-1">&gt;</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">Benchee</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="5878838641-1">(</span><span class="w">
  </span><span class="p" data-group-id="5878838641-2">%{</span><span class="w">
    </span><span class="s">&quot;elixir init&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k" data-group-id="5878838641-3">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">init_fn</span><span class="o">.</span><span class="p" data-group-id="5878838641-4">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5878838641-5">%{</span><span class="p" data-group-id="5878838641-5">}</span><span class="p" data-group-id="5878838641-4">)</span><span class="w"> </span><span class="k" data-group-id="5878838641-3">end</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;exla init&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k" data-group-id="5878838641-6">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">exla_init_fn</span><span class="o">.</span><span class="p" data-group-id="5878838641-7">(</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5878838641-8">%{</span><span class="p" data-group-id="5878838641-8">}</span><span class="p" data-group-id="5878838641-7">)</span><span class="w"> </span><span class="k" data-group-id="5878838641-6">end</span><span class="w">
  </span><span class="p" data-group-id="5878838641-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="ss">memory_time</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="ss">warmup</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p" data-group-id="5878838641-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evaluated</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w">
  </span><span class="nc">Evaluated</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">functions</span><span class="o">.</span><span class="w">
  </span><span class="nc">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">Benchee</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="nc">Mod</span><span class="o">.</span><span class="n">fun</span><span class="p" data-group-id="0300082014-1">(</span><span class="p" data-group-id="0300082014-1">)</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span><span class="w">
  </span><span class="nc">Alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w">

</span><span class="ss">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evaluated</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w">
  </span><span class="nc">Evaluated</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">functions</span><span class="o">.</span><span class="w">
  </span><span class="nc">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">Benchee</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="nc">Mod</span><span class="o">.</span><span class="n">fun</span><span class="p" data-group-id="0300082014-2">(</span><span class="p" data-group-id="0300082014-2">)</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span><span class="w">
  </span><span class="nc">Alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w">

</span><span class="nc">Operating</span><span class="w"> </span><span class="ss">System</span><span class="p">:</span><span class="w"> </span><span class="nc">Linux</span><span class="w">
</span><span class="nc">CPU</span><span class="w"> </span><span class="ss">Information</span><span class="p">:</span><span class="w"> </span><span class="nc">Intel</span><span class="p" data-group-id="0300082014-3">(</span><span class="nc">R</span><span class="p" data-group-id="0300082014-3">)</span><span class="w"> </span><span class="nc">Core</span><span class="p" data-group-id="0300082014-4">(</span><span class="nc">TM</span><span class="p" data-group-id="0300082014-4">)</span><span class="w"> </span><span class="n">i7</span><span class="o">-</span><span class="mi">7600</span><span class="nc">U</span><span class="w"> </span><span class="nc">CPU</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="mf">2.80</span><span class="nc">GHz</span><span class="w">
</span><span class="nc">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nc">Available</span><span class="w"> </span><span class="ss">Cores</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="nc">Available</span><span class="w"> </span><span class="ss">memory</span><span class="p">:</span><span class="w"> </span><span class="mf">24.95</span><span class="w"> </span><span class="nc">GB</span><span class="w">
</span><span class="nc">Elixir</span><span class="w"> </span><span class="mf">1.13</span><span class="o">.</span><span class="mi">4</span><span class="w">
</span><span class="nc">Erlang</span><span class="w"> </span><span class="mf">25.0</span><span class="o">.</span><span class="mi">4</span><span class="w">

</span><span class="nc">Benchmark</span><span class="w"> </span><span class="n">suite</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="ss">configuration</span><span class="p">:</span><span class="w">
</span><span class="ss">warmup</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="n">memory</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="n">reduction</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">ns</span><span class="w">
</span><span class="ss">parallel</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ss">inputs</span><span class="p">:</span><span class="w"> </span><span class="n">none</span><span class="w"> </span><span class="n">specified</span><span class="w">
</span><span class="nc">Estimated</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="n">s</span><span class="w">

</span><span class="nc">Benchmarking</span><span class="w"> </span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">...</span><span class="w">
</span><span class="nc">Benchmarking</span><span class="w"> </span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">...</span><span class="w">

</span><span class="nc">Name</span><span class="w">                  </span><span class="n">ips</span><span class="w">        </span><span class="n">average</span><span class="w">  </span><span class="n">deviation</span><span class="w">         </span><span class="n">median</span><span class="w">         </span><span class="mi">99</span><span class="n">th</span><span class="w"> </span><span class="p">%</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w">          </span><span class="mf">3.79</span><span class="w"> </span><span class="nc">K</span><span class="w">        </span><span class="mf">0.26</span><span class="w"> </span><span class="n">ms</span><span class="w">   </span><span class="err">±</span><span class="mf">100.40</span><span class="p">%</span><span class="w">        </span><span class="mf">0.24</span><span class="w"> </span><span class="n">ms</span><span class="w">        </span><span class="mf">0.97</span><span class="w"> </span><span class="n">ms</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w">        </span><span class="mf">0.52</span><span class="w"> </span><span class="nc">K</span><span class="w">        </span><span class="mf">1.91</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="err">±</span><span class="mf">35.03</span><span class="p">%</span><span class="w">        </span><span class="mf">1.72</span><span class="w"> </span><span class="n">ms</span><span class="w">        </span><span class="mf">3.72</span><span class="w"> </span><span class="n">ms</span><span class="w">

</span><span class="ss">Comparison</span><span class="p">:</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w">          </span><span class="mf">3.79</span><span class="w"> </span><span class="nc">K</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w">        </span><span class="mf">0.52</span><span class="w"> </span><span class="nc">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">7.25</span><span class="n">x</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="o">+</span><span class="mf">1.65</span><span class="w"> </span><span class="n">ms</span><span class="w">

</span><span class="nc">Memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="ss">statistics</span><span class="p">:</span><span class="w">

</span><span class="nc">Name</span><span class="w">           </span><span class="nc">Memory</span><span class="w"> </span><span class="n">usage</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">init</span><span class="w">           </span><span class="mf">9.80</span><span class="w"> </span><span class="nc">KB</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">init</span><span class="w">       </span><span class="mf">644.63</span><span class="w"> </span><span class="nc">KB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">65.80</span><span class="n">x</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="o">+</span><span class="mf">634.83</span><span class="w"> </span><span class="nc">KB</span><span class="w">

</span><span class="o">*</span><span class="o">*</span><span class="nc">All</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="o">*</span><span class="o">*</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">Benchee</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4497880309-1">(</span><span class="w">
  </span><span class="p" data-group-id="4497880309-2">%{</span><span class="w">
    </span><span class="s">&quot;elixir predict&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k" data-group-id="4497880309-3">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">predict_fn</span><span class="o">.</span><span class="p" data-group-id="4497880309-4">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="4497880309-4">)</span><span class="w"> </span><span class="k" data-group-id="4497880309-3">end</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;exla predict&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="k" data-group-id="4497880309-5">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">exla_predict_fn</span><span class="o">.</span><span class="p" data-group-id="4497880309-6">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">inputs</span><span class="p" data-group-id="4497880309-6">)</span><span class="w"> </span><span class="k" data-group-id="4497880309-5">end</span><span class="w">
  </span><span class="p" data-group-id="4497880309-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="ss">memory_time</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="ss">warmup</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p" data-group-id="4497880309-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evaluated</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w">
  </span><span class="nc">Evaluated</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">functions</span><span class="o">.</span><span class="w">
  </span><span class="nc">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">Benchee</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="nc">Mod</span><span class="o">.</span><span class="n">fun</span><span class="p" data-group-id="7470313437-1">(</span><span class="p" data-group-id="7470313437-1">)</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span><span class="w">
  </span><span class="nc">Alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w">

</span><span class="ss">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evaluated</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w">
  </span><span class="nc">Evaluated</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">functions</span><span class="o">.</span><span class="w">
  </span><span class="nc">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">Benchee</span><span class="w"> </span><span class="n">caller</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="err">`</span><span class="nc">Mod</span><span class="o">.</span><span class="n">fun</span><span class="p" data-group-id="7470313437-2">(</span><span class="p" data-group-id="7470313437-2">)</span><span class="err">`</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span><span class="w">
  </span><span class="nc">Alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">move</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benchmark</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">benchmark</span><span class="o">.</span><span class="n">exs</span><span class="w">

</span><span class="nc">Operating</span><span class="w"> </span><span class="ss">System</span><span class="p">:</span><span class="w"> </span><span class="nc">Linux</span><span class="w">
</span><span class="nc">CPU</span><span class="w"> </span><span class="ss">Information</span><span class="p">:</span><span class="w"> </span><span class="nc">Intel</span><span class="p" data-group-id="7470313437-3">(</span><span class="nc">R</span><span class="p" data-group-id="7470313437-3">)</span><span class="w"> </span><span class="nc">Core</span><span class="p" data-group-id="7470313437-4">(</span><span class="nc">TM</span><span class="p" data-group-id="7470313437-4">)</span><span class="w"> </span><span class="n">i7</span><span class="o">-</span><span class="mi">7600</span><span class="nc">U</span><span class="w"> </span><span class="nc">CPU</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="mf">2.80</span><span class="nc">GHz</span><span class="w">
</span><span class="nc">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="nc">Available</span><span class="w"> </span><span class="ss">Cores</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="nc">Available</span><span class="w"> </span><span class="ss">memory</span><span class="p">:</span><span class="w"> </span><span class="mf">24.95</span><span class="w"> </span><span class="nc">GB</span><span class="w">
</span><span class="nc">Elixir</span><span class="w"> </span><span class="mf">1.13</span><span class="o">.</span><span class="mi">4</span><span class="w">
</span><span class="nc">Erlang</span><span class="w"> </span><span class="mf">25.0</span><span class="o">.</span><span class="mi">4</span><span class="w">

</span><span class="nc">Benchmark</span><span class="w"> </span><span class="n">suite</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="ss">configuration</span><span class="p">:</span><span class="w">
</span><span class="ss">warmup</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="n">memory</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">s</span><span class="w">
</span><span class="n">reduction</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">ns</span><span class="w">
</span><span class="ss">parallel</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="ss">inputs</span><span class="p">:</span><span class="w"> </span><span class="n">none</span><span class="w"> </span><span class="n">specified</span><span class="w">
</span><span class="nc">Estimated</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="ss">time</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="n">s</span><span class="w">

</span><span class="nc">Benchmarking</span><span class="w"> </span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w"> </span><span class="n">...</span><span class="w">
</span><span class="nc">Benchmarking</span><span class="w"> </span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w"> </span><span class="n">...</span><span class="w">

</span><span class="nc">Name</span><span class="w">                     </span><span class="n">ips</span><span class="w">        </span><span class="n">average</span><span class="w">  </span><span class="n">deviation</span><span class="w">         </span><span class="n">median</span><span class="w">         </span><span class="mi">99</span><span class="n">th</span><span class="w"> </span><span class="p">%</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w">          </span><span class="mf">2.32</span><span class="w"> </span><span class="nc">K</span><span class="w">        </span><span class="mf">0.43</span><span class="w"> </span><span class="n">ms</span><span class="w">   </span><span class="err">±</span><span class="mf">147.05</span><span class="p">%</span><span class="w">        </span><span class="mf">0.34</span><span class="w"> </span><span class="n">ms</span><span class="w">        </span><span class="mf">1.61</span><span class="w"> </span><span class="n">ms</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w">        </span><span class="mf">0.28</span><span class="w"> </span><span class="nc">K</span><span class="w">        </span><span class="mf">3.53</span><span class="w"> </span><span class="n">ms</span><span class="w">    </span><span class="err">±</span><span class="mf">42.21</span><span class="p">%</span><span class="w">        </span><span class="mf">3.11</span><span class="w"> </span><span class="n">ms</span><span class="w">        </span><span class="mf">7.26</span><span class="w"> </span><span class="n">ms</span><span class="w">

</span><span class="ss">Comparison</span><span class="p">:</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w">          </span><span class="mf">2.32</span><span class="w"> </span><span class="nc">K</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w">        </span><span class="mf">0.28</span><span class="w"> </span><span class="nc">K</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">8.20</span><span class="n">x</span><span class="w"> </span><span class="n">slower</span><span class="w"> </span><span class="o">+</span><span class="mf">3.10</span><span class="w"> </span><span class="n">ms</span><span class="w">

</span><span class="nc">Memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="ss">statistics</span><span class="p">:</span><span class="w">

</span><span class="nc">Name</span><span class="w">              </span><span class="nc">Memory</span><span class="w"> </span><span class="n">usage</span><span class="w">
</span><span class="n">exla</span><span class="w"> </span><span class="n">predict</span><span class="w">          </span><span class="mf">10.95</span><span class="w"> </span><span class="nc">KB</span><span class="w">
</span><span class="n">elixir</span><span class="w"> </span><span class="n">predict</span><span class="w">        </span><span class="mf">91.09</span><span class="w"> </span><span class="nc">KB</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">8.32</span><span class="n">x</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="o">+</span><span class="mf">80.14</span><span class="w"> </span><span class="nc">KB</span><span class="w">

</span><span class="o">*</span><span class="o">*</span><span class="nc">All</span><span class="w"> </span><span class="n">measurements</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="o">*</span><span class="o">*</span></code></pre><p>Notice how calls to EXLA variants are significantly faster. These speedups become more pronounced with more complex models and workflows.</p><!-- livebook:{"break_markdown":true} --><p>It's important to note that in order to use a given library as an Nx compiler, it must implement the Nx compilation behaviour. For example, you cannot invoke Torchx as an Nx compiler because it does not support JIT compilation at this time.</p><h2 id="a-note-on-cpus-gpus-tpus" class="section-heading">
  <a href="#a-note-on-cpus-gpus-tpus" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">A Note on CPUs/GPUs/TPUs</span>
</h2>
<p>While Nx mostly tries to standardize behavior across compilers and backends, some behaviors are backend-specific. For example, the API for choosing an acceleration platform (e.g. CUDA/ROCm/TPU) is backend-specific. You should refer to your chosen compiler or backend's documentation for information on targeting various accelerators. Typically, you only need to change a few configuration options and your code will run as-is on a chosen accelerator.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="model_hooks.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Model hooks
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="training_and_inference_mode.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Training and inference mode
        </span>
      </a>

  </div>
</div>
      <footer class="footer">
        <p>

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.6.1" class="footer-hex-package">Hex Package</a>

              <a href="https://preview.hex.pm/preview/axon/0.6.1">Hex Preview</a>

                (<a href="https://preview.hex.pm/preview/axon/0.6.1/show/guides/model_execution/accelerating_axon.livemd">current file</a>)

            </span>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Axon.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.31.1) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</main>
</div>

<!-- Render math with KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ]
    });
  });
</script>

<!-- Render diagrams with Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({ startOnLoad: false });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition, function (svgSource, bindListeners) {
        graphEl.innerHTML = svgSource;
        bindListeners && bindListeners(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
