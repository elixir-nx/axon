<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.31.1">
    <meta name="project" content="Axon v0.6.1">


    <title>Writing custom event handlers â€” Axon v0.6.1</title>
    <link rel="stylesheet" href="dist/html-elixir-FM2CSD74.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-43PMFBC7.js"></script>
    <script src="dist/sidebar_items-496153D3.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/html-L4O5OK2K.js"></script>


  </head>
  <body data-type="extras" class="page-livemd">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<div class="background-layer"></div>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="Axon.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Axon" />
        </a>

      <div>
        <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.6.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">
      <div class="top-search">
        <div class="search-settings">
          <form class="search-bar" action="search.html">
            <label class="search-label">
              <span class="sr-only">Search documentation of Axon</span>
              <input name="q" type="text" class="search-input" placeholder="Search Documentation (press /)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            </label>
            <button type="submit" class="search-button" aria-label="Submit Search">
              <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
            </button>
            <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
              <i class="ri-close-line ri-lg" title="Cancel search"></i>
            </button>
          </form>
          <div class="autocomplete">
          </div>
          <button class="icon-settings display-settings">
            <i class="ri-settings-3-line"></i>
            <span class="sr-only">Settings</span>
          </button>
        </div>

      </div>

<h1>

    <a href="https://github.com/elixir-nx/axon/blob/v0.6.1/guides/training_and_evaluation/writing_custom_event_handlers.livemd#L1" title="View Source" class="icon-action" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>


  <span>Writing custom event handlers</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="2720154235-1">(</span><span class="p" data-group-id="2720154235-2">[</span><span class="w">
  </span><span class="p" data-group-id="2720154235-3">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&gt;= 0.5.0&quot;</span><span class="p" data-group-id="2720154235-3">}</span><span class="w">
</span><span class="p" data-group-id="2720154235-2">]</span><span class="p" data-group-id="2720154235-1">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">:ok</span></code></pre><h2 id="writing-custom-event-handlers" class="section-heading">
  <a href="#writing-custom-event-handlers" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Writing custom event handlers</span>
</h2>
<p>If you require functionality not offered by any of Axon's built-in event handlers, then you'll need to write a custom event handler. Custom event handlers are functions which accept loop state, perform some action, and then defer execution back to the main loop. For example, you can write custom loop handlers which visualize model outputs, communicate with an external Kino process, or simply halt the loop based on some criteria.</p><p>All event handlers must accept an <code class="inline">%Axon.Loop.State{}</code> struct and return a tuple of <code class="inline">{control_term, state}</code> where <code class="inline">control_term</code> is one of <code class="inline">:continue</code>, <code class="inline">:halt_epoch</code>, or <code class="inline">:halt_loop</code> and <code class="inline">state</code> is the updated loop state:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">CustomEventHandler0</span><span class="w"> </span><span class="k" data-group-id="1481095087-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Axon.Loop.State</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">my_weird_handler</span><span class="p" data-group-id="1481095087-2">(</span><span class="p" data-group-id="1481095087-3">%</span><span class="nc" data-group-id="1481095087-3">State</span><span class="p" data-group-id="1481095087-3">{</span><span class="p" data-group-id="1481095087-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="1481095087-2">)</span><span class="w"> </span><span class="k" data-group-id="1481095087-4">do</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="1481095087-5">(</span><span class="s">&quot;My weird handler: fired&quot;</span><span class="p" data-group-id="1481095087-5">)</span><span class="w">
    </span><span class="p" data-group-id="1481095087-6">{</span><span class="ss">:continue</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="1481095087-6">}</span><span class="w">
  </span><span class="k" data-group-id="1481095087-4">end</span><span class="w">
</span><span class="k" data-group-id="1481095087-1">end</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="7158097619-1">{</span><span class="ss">:module</span><span class="p">,</span><span class="w"> </span><span class="nc">CustomEventHandler0</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7158097619-2">&lt;&lt;</span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">82</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="7158097619-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7158097619-3">{</span><span class="ss">:my_weird_handler</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="7158097619-3">}</span><span class="p" data-group-id="7158097619-1">}</span></code></pre><p>To register event handlers, you use <code class="inline">Axon.Loop.handle/4</code>:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="2817616831-1">(</span><span class="s">&quot;data&quot;</span><span class="p" data-group-id="2817616831-1">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="2817616831-2">(</span><span class="mi">8</span><span class="p" data-group-id="2817616831-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="2817616831-3">(</span><span class="p" data-group-id="2817616831-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="2817616831-4">(</span><span class="mi">4</span><span class="p" data-group-id="2817616831-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="2817616831-5">(</span><span class="p" data-group-id="2817616831-5">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="2817616831-6">(</span><span class="mi">1</span><span class="p" data-group-id="2817616831-6">)</span><span class="w">

</span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="n">model</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="2817616831-7">(</span><span class="ss">:mean_squared_error</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="2817616831-7">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle_event</span><span class="p" data-group-id="2817616831-8">(</span><span class="ss">:epoch_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">CustomEventHandler0</span><span class="o">.</span><span class="n">my_weird_handler</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2817616831-8">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="2291783109-1">#</span><span class="nc" data-group-id="2291783109-1">Axon.Loop</span><span class="p" data-group-id="2291783109-1">&lt;</span><span class="w">
  </span><span class="ss">metrics</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-2">%{</span><span class="w">
    </span><span class="s">&quot;loss&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="2291783109-3">{</span><span class="p" data-group-id="2291783109-4">#</span><span class="nc" data-group-id="2291783109-4">Function</span><span class="p" data-group-id="2291783109-4">&lt;</span><span class="mf">11.133813849</span><span class="o">/</span><span class="mi">3</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Metrics</span><span class="o">.</span><span class="n">running_average</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2291783109-4">&gt;</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="2291783109-5">#</span><span class="nc" data-group-id="2291783109-5">Function</span><span class="p" data-group-id="2291783109-5">&lt;</span><span class="mf">9.37390314</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_loss_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2291783109-5">&gt;</span><span class="p" data-group-id="2291783109-3">}</span><span class="w">
  </span><span class="p" data-group-id="2291783109-2">}</span><span class="p">,</span><span class="w">
  </span><span class="ss">handlers</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-6">%{</span><span class="w">
    </span><span class="ss">completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-7">[</span><span class="p" data-group-id="2291783109-7">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-8">[</span><span class="w">
      </span><span class="p" data-group-id="2291783109-9">{</span><span class="o">&amp;</span><span class="nc">CustomEventHandler0</span><span class="o">.</span><span class="n">my_weird_handler</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="2291783109-10">#</span><span class="nc" data-group-id="2291783109-10">Function</span><span class="p" data-group-id="2291783109-10">&lt;</span><span class="mf">6.37390314</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_filter_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2291783109-10">&gt;</span><span class="p" data-group-id="2291783109-9">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="2291783109-11">{</span><span class="p" data-group-id="2291783109-12">#</span><span class="nc" data-group-id="2291783109-12">Function</span><span class="p" data-group-id="2291783109-12">&lt;</span><span class="mf">27.37390314</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">log</span><span class="o">/</span><span class="mi">3</span><span class="p" data-group-id="2291783109-12">&gt;</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="2291783109-13">#</span><span class="nc" data-group-id="2291783109-13">Function</span><span class="p" data-group-id="2291783109-13">&lt;</span><span class="mf">6.37390314</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_filter_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2291783109-13">&gt;</span><span class="p" data-group-id="2291783109-11">}</span><span class="w">
    </span><span class="p" data-group-id="2291783109-8">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_halted</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-14">[</span><span class="p" data-group-id="2291783109-14">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">epoch_started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-15">[</span><span class="p" data-group-id="2291783109-15">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">halted</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-16">[</span><span class="p" data-group-id="2291783109-16">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">iteration_completed</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-17">[</span><span class="w">
      </span><span class="p" data-group-id="2291783109-18">{</span><span class="p" data-group-id="2291783109-19">#</span><span class="nc" data-group-id="2291783109-19">Function</span><span class="p" data-group-id="2291783109-19">&lt;</span><span class="mf">27.37390314</span><span class="o">/</span><span class="mi">1</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">log</span><span class="o">/</span><span class="mi">3</span><span class="p" data-group-id="2291783109-19">&gt;</span><span class="p">,</span><span class="w">
       </span><span class="p" data-group-id="2291783109-20">#</span><span class="nc" data-group-id="2291783109-20">Function</span><span class="p" data-group-id="2291783109-20">&lt;</span><span class="mf">64.37390314</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">build_filter_fn</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2291783109-20">&gt;</span><span class="p" data-group-id="2291783109-18">}</span><span class="w">
    </span><span class="p" data-group-id="2291783109-17">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">iteration_started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-21">[</span><span class="p" data-group-id="2291783109-21">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">started</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2291783109-22">[</span><span class="p" data-group-id="2291783109-22">]</span><span class="w">
  </span><span class="p" data-group-id="2291783109-6">}</span><span class="p">,</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="p" data-group-id="2291783109-1">&gt;</span></code></pre><p>Axon will trigger your custom handler to run on the attached event:</p><pre><code class="makeup elixir" translate="no"><span class="n">train_data</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="nc">Stream</span><span class="o">.</span><span class="n">repeatedly</span><span class="p" data-group-id="7170896667-1">(</span><span class="k" data-group-id="7170896667-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="p" data-group-id="7170896667-3">{</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="c">_next_key</span><span class="p" data-group-id="7170896667-3">}</span><span class="w"> </span><span class="o">=</span><span class="w">
      </span><span class="nc">:random</span><span class="o">.</span><span class="n">uniform</span><span class="p" data-group-id="7170896667-4">(</span><span class="mi">9999</span><span class="p" data-group-id="7170896667-4">)</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx.Random</span><span class="o">.</span><span class="n">key</span><span class="p" data-group-id="7170896667-5">(</span><span class="p" data-group-id="7170896667-5">)</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx.Random</span><span class="o">.</span><span class="n">normal</span><span class="p" data-group-id="7170896667-6">(</span><span class="ss">shape</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7170896667-7">{</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="7170896667-7">}</span><span class="p" data-group-id="7170896667-6">)</span><span class="w">

    </span><span class="n">ys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">sin</span><span class="p" data-group-id="7170896667-8">(</span><span class="n">xs</span><span class="p" data-group-id="7170896667-8">)</span><span class="w">
    </span><span class="p" data-group-id="7170896667-9">{</span><span class="n">xs</span><span class="p">,</span><span class="w"> </span><span class="n">ys</span><span class="p" data-group-id="7170896667-9">}</span><span class="w">
  </span><span class="k" data-group-id="7170896667-2">end</span><span class="p" data-group-id="7170896667-1">)</span><span class="w">

</span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="7170896667-10">(</span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">train_data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7170896667-11">%{</span><span class="p" data-group-id="7170896667-11">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="7170896667-10">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0990703</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0567622</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0492784</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0462587</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span><span class="w">
</span><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0452806</span><span class="w">
</span><span class="nc">My</span><span class="w"> </span><span class="n">weird</span><span class="w"> </span><span class="ss">handler</span><span class="p">:</span><span class="w"> </span><span class="n">fired</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="0348385324-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-3">#</span><span class="nc" data-group-id="0348385324-3">Nx.Tensor</span><span class="p" data-group-id="0348385324-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="0348385324-4">[</span><span class="mi">8</span><span class="p" data-group-id="0348385324-4">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-5">[</span><span class="mf">0.10819189250469208</span><span class="p">,</span><span class="w"> </span><span class="mf">0.008151392452418804</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0318693183362484</span><span class="p">,</span><span class="w"> </span><span class="mf">0.010302421636879444</span><span class="p">,</span><span class="w"> </span><span class="mf">0.15788722038269043</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05119801685214043</span><span class="p">,</span><span class="w"> </span><span class="mf">0.14268818497657776</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.11528034508228302</span><span class="p" data-group-id="0348385324-5">]</span><span class="w">
    </span><span class="p" data-group-id="0348385324-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-6">#</span><span class="nc" data-group-id="0348385324-6">Nx.Tensor</span><span class="p" data-group-id="0348385324-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="0348385324-7">[</span><span class="mi">1</span><span class="p" data-group-id="0348385324-7">]</span><span class="p" data-group-id="0348385324-8">[</span><span class="mi">8</span><span class="p" data-group-id="0348385324-8">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-9">[</span><span class="w">
        </span><span class="p" data-group-id="0348385324-10">[</span><span class="o">-</span><span class="mf">0.4275593161582947</span><span class="p">,</span><span class="w"> </span><span class="mf">0.40442031621932983</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7287659645080566</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.7832129597663879</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3329123258590698</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5598123073577881</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8389336466789246</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3197469413280487</span><span class="p" data-group-id="0348385324-10">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-9">]</span><span class="w">
    </span><span class="p" data-group-id="0348385324-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="0348385324-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-11">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-12">#</span><span class="nc" data-group-id="0348385324-12">Nx.Tensor</span><span class="p" data-group-id="0348385324-12">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="0348385324-13">[</span><span class="mi">4</span><span class="p" data-group-id="0348385324-13">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-14">[</span><span class="mf">0.0671013742685318</span><span class="p">,</span><span class="w"> </span><span class="mf">0.13561469316482544</span><span class="p">,</span><span class="w"> </span><span class="mf">0.06218714639544487</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2104845941066742</span><span class="p" data-group-id="0348385324-14">]</span><span class="w">
    </span><span class="p" data-group-id="0348385324-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-15">#</span><span class="nc" data-group-id="0348385324-15">Nx.Tensor</span><span class="p" data-group-id="0348385324-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="0348385324-16">[</span><span class="mi">8</span><span class="p" data-group-id="0348385324-16">]</span><span class="p" data-group-id="0348385324-17">[</span><span class="mi">4</span><span class="p" data-group-id="0348385324-17">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-18">[</span><span class="w">
        </span><span class="p" data-group-id="0348385324-19">[</span><span class="mf">0.4444102942943573</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4518184959888458</span><span class="p">,</span><span class="w"> </span><span class="mf">0.45315614342689514</span><span class="p">,</span><span class="w"> </span><span class="mf">0.35392478108406067</span><span class="p" data-group-id="0348385324-19">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-20">[</span><span class="mf">0.008407601155340672</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6081852912902832</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.05863206833600998</span><span class="p">,</span><span class="w"> </span><span class="mf">0.14386630058288574</span><span class="p" data-group-id="0348385324-20">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-21">[</span><span class="o">-</span><span class="mf">0.010219200514256954</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5528244376182556</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3754919469356537</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6242967247962952</span><span class="p" data-group-id="0348385324-21">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-22">[</span><span class="mf">0.3531058132648468</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.18348301947116852</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0019897441379725933</span><span class="p">,</span><span class="w"> </span><span class="mf">0.41002658009529114</span><span class="p" data-group-id="0348385324-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-23">[</span><span class="mf">0.676723062992096</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.09349705278873444</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1101854145526886</span><span class="p">,</span><span class="w"> </span><span class="mf">0.06494166702032089</span><span class="p" data-group-id="0348385324-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-24">[</span><span class="mf">0.1534113883972168</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6402403116226196</span><span class="p">,</span><span class="w"> </span><span class="mf">0.23490086197853088</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2196572870016098</span><span class="p" data-group-id="0348385324-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-25">[</span><span class="mf">0.5835862755775452</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6581316590309143</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3047991394996643</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.07485166192054749</span><span class="p" data-group-id="0348385324-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-26">[</span><span class="o">-</span><span class="mf">0.6115342378616333</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3316897749900818</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3606548309326172</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3397740423679352</span><span class="p" data-group-id="0348385324-26">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-18">]</span><span class="w">
    </span><span class="p" data-group-id="0348385324-15">&gt;</span><span class="w">
  </span><span class="p" data-group-id="0348385324-11">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-27">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-28">#</span><span class="nc" data-group-id="0348385324-28">Nx.Tensor</span><span class="p" data-group-id="0348385324-28">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="0348385324-29">[</span><span class="mi">1</span><span class="p" data-group-id="0348385324-29">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-30">[</span><span class="mf">0.10111129283905029</span><span class="p" data-group-id="0348385324-30">]</span><span class="w">
    </span><span class="p" data-group-id="0348385324-28">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="0348385324-31">#</span><span class="nc" data-group-id="0348385324-31">Nx.Tensor</span><span class="p" data-group-id="0348385324-31">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="0348385324-32">[</span><span class="mi">4</span><span class="p" data-group-id="0348385324-32">]</span><span class="p" data-group-id="0348385324-33">[</span><span class="mi">1</span><span class="p" data-group-id="0348385324-33">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-34">[</span><span class="w">
        </span><span class="p" data-group-id="0348385324-35">[</span><span class="mf">0.7433153390884399</span><span class="p" data-group-id="0348385324-35">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-36">[</span><span class="o">-</span><span class="mf">0.8213723301887512</span><span class="p" data-group-id="0348385324-36">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-37">[</span><span class="o">-</span><span class="mf">0.44361063838005066</span><span class="p" data-group-id="0348385324-37">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="0348385324-38">[</span><span class="o">-</span><span class="mf">1.049617052078247</span><span class="p" data-group-id="0348385324-38">]</span><span class="w">
      </span><span class="p" data-group-id="0348385324-34">]</span><span class="w">
    </span><span class="p" data-group-id="0348385324-31">&gt;</span><span class="w">
  </span><span class="p" data-group-id="0348385324-27">}</span><span class="w">
</span><span class="p" data-group-id="0348385324-1">}</span></code></pre><p>You can use event handlers to early-stop a loop or loop epoch by returning a <code class="inline">:halt_*</code> control term. Halt control terms can be one of <code class="inline">:halt_epoch</code> or <code class="inline">:halt_loop</code>. <code class="inline">:halt_epoch</code> halts the current epoch and continues to the next. <code class="inline">:halt_loop</code> halts the loop altogether.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">CustomEventHandler1</span><span class="w"> </span><span class="k" data-group-id="4101522500-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Axon.Loop.State</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">always_halts</span><span class="p" data-group-id="4101522500-2">(</span><span class="p" data-group-id="4101522500-3">%</span><span class="nc" data-group-id="4101522500-3">State</span><span class="p" data-group-id="4101522500-3">{</span><span class="p" data-group-id="4101522500-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="4101522500-2">)</span><span class="w"> </span><span class="k" data-group-id="4101522500-4">do</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="4101522500-5">(</span><span class="s">&quot;stopping loop&quot;</span><span class="p" data-group-id="4101522500-5">)</span><span class="w">
    </span><span class="p" data-group-id="4101522500-6">{</span><span class="ss">:halt_loop</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="4101522500-6">}</span><span class="w">
  </span><span class="k" data-group-id="4101522500-4">end</span><span class="w">
</span><span class="k" data-group-id="4101522500-1">end</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="6958703377-1">{</span><span class="ss">:module</span><span class="p">,</span><span class="w"> </span><span class="nc">CustomEventHandler1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6958703377-2">&lt;&lt;</span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">82</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="6958703377-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6958703377-3">{</span><span class="ss">:always_halts</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6958703377-3">}</span><span class="p" data-group-id="6958703377-1">}</span></code></pre><p>The loop will immediately stop executing and return the current state at the time it was halted:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="7242998232-1">(</span><span class="ss">:mean_squared_error</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="7242998232-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle_event</span><span class="p" data-group-id="7242998232-2">(</span><span class="ss">:epoch_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">CustomEventHandler1</span><span class="o">.</span><span class="n">always_halts</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7242998232-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="7242998232-3">(</span><span class="n">train_data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7242998232-4">%{</span><span class="p" data-group-id="7242998232-4">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="7242998232-3">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2201974</span><span class="w">
</span><span class="n">stopping</span><span class="w"> </span><span class="n">loop</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="7652266420-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-3">#</span><span class="nc" data-group-id="7652266420-3">Nx.Tensor</span><span class="p" data-group-id="7652266420-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="7652266420-4">[</span><span class="mi">8</span><span class="p" data-group-id="7652266420-4">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-5">[</span><span class="mf">0.07676638662815094</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.18689222633838654</span><span class="p">,</span><span class="w"> </span><span class="mf">0.10066182911396027</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.021994125097990036</span><span class="p">,</span><span class="w"> </span><span class="mf">0.12006694823503494</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.014219668693840504</span><span class="p">,</span><span class="w"> </span><span class="mf">0.13600556552410126</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.017512166872620583</span><span class="p" data-group-id="7652266420-5">]</span><span class="w">
    </span><span class="p" data-group-id="7652266420-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-6">#</span><span class="nc" data-group-id="7652266420-6">Nx.Tensor</span><span class="p" data-group-id="7652266420-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="7652266420-7">[</span><span class="mi">1</span><span class="p" data-group-id="7652266420-7">]</span><span class="p" data-group-id="7652266420-8">[</span><span class="mi">8</span><span class="p" data-group-id="7652266420-8">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-9">[</span><span class="w">
        </span><span class="p" data-group-id="7652266420-10">[</span><span class="o">-</span><span class="mf">0.5354958772659302</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.216745987534523</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5694359540939331</span><span class="p">,</span><span class="w"> </span><span class="mf">0.023495405912399292</span><span class="p">,</span><span class="w"> </span><span class="mf">0.17701618373394012</span><span class="p">,</span><span class="w"> </span><span class="mf">0.011712944135069847</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5289720892906189</span><span class="p">,</span><span class="w"> </span><span class="mf">0.07360327988862991</span><span class="p" data-group-id="7652266420-10">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-9">]</span><span class="w">
    </span><span class="p" data-group-id="7652266420-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="7652266420-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-11">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-12">#</span><span class="nc" data-group-id="7652266420-12">Nx.Tensor</span><span class="p" data-group-id="7652266420-12">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="7652266420-13">[</span><span class="mi">4</span><span class="p" data-group-id="7652266420-13">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-14">[</span><span class="mf">0.0012482400052249432</span><span class="p">,</span><span class="w"> </span><span class="mf">0.09300543367862701</span><span class="p">,</span><span class="w"> </span><span class="mf">0.08570009469985962</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.018982920795679092</span><span class="p" data-group-id="7652266420-14">]</span><span class="w">
    </span><span class="p" data-group-id="7652266420-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-15">#</span><span class="nc" data-group-id="7652266420-15">Nx.Tensor</span><span class="p" data-group-id="7652266420-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="7652266420-16">[</span><span class="mi">8</span><span class="p" data-group-id="7652266420-16">]</span><span class="p" data-group-id="7652266420-17">[</span><span class="mi">4</span><span class="p" data-group-id="7652266420-17">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-18">[</span><span class="w">
        </span><span class="p" data-group-id="7652266420-19">[</span><span class="mf">0.3016211688518524</span><span class="p">,</span><span class="w"> </span><span class="mf">0.31998082995414734</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3300730884075165</span><span class="p">,</span><span class="w"> </span><span class="mf">0.24982869625091553</span><span class="p" data-group-id="7652266420-19">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-20">[</span><span class="mf">0.03864569962024689</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.44071364402770996</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6553062200546265</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5294798612594604</span><span class="p" data-group-id="7652266420-20">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-21">[</span><span class="mf">0.25020459294319153</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7249991297721863</span><span class="p">,</span><span class="w"> </span><span class="mf">0.15611837804317474</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5045580863952637</span><span class="p" data-group-id="7652266420-21">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-22">[</span><span class="o">-</span><span class="mf">0.5500670075416565</span><span class="p">,</span><span class="w"> </span><span class="mf">0.15677094459533691</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.6531851291656494</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.09289993345737457</span><span class="p" data-group-id="7652266420-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-23">[</span><span class="mf">0.1618722379207611</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4479053020477295</span><span class="p">,</span><span class="w"> </span><span class="mf">0.705923318862915</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3853490352630615</span><span class="p" data-group-id="7652266420-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-24">[</span><span class="o">-</span><span class="mf">0.6752215623855591</span><span class="p">,</span><span class="w"> </span><span class="mf">0.577272891998291</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1268012821674347</span><span class="p">,</span><span class="w"> </span><span class="mf">0.6133111715316772</span><span class="p" data-group-id="7652266420-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-25">[</span><span class="mf">0.5361366271972656</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2996085286140442</span><span class="p">,</span><span class="w"> </span><span class="mf">0.28480708599090576</span><span class="p">,</span><span class="w"> </span><span class="mf">0.47739118337631226</span><span class="p" data-group-id="7652266420-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-26">[</span><span class="o">-</span><span class="mf">0.6443014144897461</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2866927981376648</span><span class="p">,</span><span class="w"> </span><span class="mf">0.023463081568479538</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1491370052099228</span><span class="p" data-group-id="7652266420-26">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-18">]</span><span class="w">
    </span><span class="p" data-group-id="7652266420-15">&gt;</span><span class="w">
  </span><span class="p" data-group-id="7652266420-11">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-27">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-28">#</span><span class="nc" data-group-id="7652266420-28">Nx.Tensor</span><span class="p" data-group-id="7652266420-28">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="7652266420-29">[</span><span class="mi">1</span><span class="p" data-group-id="7652266420-29">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-30">[</span><span class="mf">0.0047520860098302364</span><span class="p" data-group-id="7652266420-30">]</span><span class="w">
    </span><span class="p" data-group-id="7652266420-28">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="7652266420-31">#</span><span class="nc" data-group-id="7652266420-31">Nx.Tensor</span><span class="p" data-group-id="7652266420-31">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="7652266420-32">[</span><span class="mi">4</span><span class="p" data-group-id="7652266420-32">]</span><span class="p" data-group-id="7652266420-33">[</span><span class="mi">1</span><span class="p" data-group-id="7652266420-33">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-34">[</span><span class="w">
        </span><span class="p" data-group-id="7652266420-35">[</span><span class="mf">0.3796459138393402</span><span class="p" data-group-id="7652266420-35">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-36">[</span><span class="o">-</span><span class="mf">0.9757304191589355</span><span class="p" data-group-id="7652266420-36">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-37">[</span><span class="mf">0.9530885815620422</span><span class="p" data-group-id="7652266420-37">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="7652266420-38">[</span><span class="o">-</span><span class="mf">0.05134368687868118</span><span class="p" data-group-id="7652266420-38">]</span><span class="w">
      </span><span class="p" data-group-id="7652266420-34">]</span><span class="w">
    </span><span class="p" data-group-id="7652266420-31">&gt;</span><span class="w">
  </span><span class="p" data-group-id="7652266420-27">}</span><span class="w">
</span><span class="p" data-group-id="7652266420-1">}</span></code></pre><p>Note that halting an epoch will fire a different event than completing an epoch. So if you implement a custom handler to halt the loop when an epoch completes, it will never fire if the epoch always halts prematurely:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">CustomEventHandler2</span><span class="w"> </span><span class="k" data-group-id="0795335721-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Axon.Loop.State</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">always_halts_epoch</span><span class="p" data-group-id="0795335721-2">(</span><span class="p" data-group-id="0795335721-3">%</span><span class="nc" data-group-id="0795335721-3">State</span><span class="p" data-group-id="0795335721-3">{</span><span class="p" data-group-id="0795335721-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="0795335721-2">)</span><span class="w"> </span><span class="k" data-group-id="0795335721-4">do</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="0795335721-5">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">stopping epoch&quot;</span><span class="p" data-group-id="0795335721-5">)</span><span class="w">
    </span><span class="p" data-group-id="0795335721-6">{</span><span class="ss">:halt_epoch</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="0795335721-6">}</span><span class="w">
  </span><span class="k" data-group-id="0795335721-4">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">always_halts_loop</span><span class="p" data-group-id="0795335721-7">(</span><span class="p" data-group-id="0795335721-8">%</span><span class="nc" data-group-id="0795335721-8">State</span><span class="p" data-group-id="0795335721-8">{</span><span class="p" data-group-id="0795335721-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="0795335721-7">)</span><span class="w"> </span><span class="k" data-group-id="0795335721-9">do</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="0795335721-10">(</span><span class="s">&quot;stopping loop</span><span class="se">\n</span><span class="s">&quot;</span><span class="p" data-group-id="0795335721-10">)</span><span class="w">
    </span><span class="p" data-group-id="0795335721-11">{</span><span class="ss">:halt_loop</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="0795335721-11">}</span><span class="w">
  </span><span class="k" data-group-id="0795335721-9">end</span><span class="w">
</span><span class="k" data-group-id="0795335721-1">end</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="3195129175-1">{</span><span class="ss">:module</span><span class="p">,</span><span class="w"> </span><span class="nc">CustomEventHandler2</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195129175-2">&lt;&lt;</span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w"> </span><span class="mi">82</span><span class="p">,</span><span class="w"> </span><span class="mi">49</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p" data-group-id="3195129175-2">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3195129175-3">{</span><span class="ss">:always_halts_loop</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3195129175-3">}</span><span class="p" data-group-id="3195129175-1">}</span></code></pre><p>If you run these handlers in conjunction, the loop will not terminate prematurely:</p><pre><code class="makeup elixir" translate="no"><span class="n">model</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="6202087822-1">(</span><span class="ss">:mean_squared_error</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="6202087822-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle_event</span><span class="p" data-group-id="6202087822-2">(</span><span class="ss">:iteration_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">CustomEventHandler2</span><span class="o">.</span><span class="n">always_halts_epoch</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="6202087822-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle_event</span><span class="p" data-group-id="6202087822-3">(</span><span class="ss">:epoch_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">CustomEventHandler2</span><span class="o">.</span><span class="n">always_halts_loop</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="6202087822-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6202087822-4">(</span><span class="n">train_data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6202087822-5">%{</span><span class="p" data-group-id="6202087822-5">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="6202087822-4">)</span></code></pre><pre><code class="makeup output" translate="no"><span class="ss">Epoch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">Batch</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">loss</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0000000</span><span class="w">
</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span><span class="w">

</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span><span class="w">

</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span><span class="w">

</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span><span class="w">

</span><span class="n">stopping</span><span class="w"> </span><span class="n">epoch</span></code></pre><pre><code class="makeup output" translate="no"><span class="p" data-group-id="9257512794-1">%{</span><span class="w">
  </span><span class="s">&quot;dense_0&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-2">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-3">#</span><span class="nc" data-group-id="9257512794-3">Nx.Tensor</span><span class="p" data-group-id="9257512794-3">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9257512794-4">[</span><span class="mi">8</span><span class="p" data-group-id="9257512794-4">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-5">[</span><span class="mf">0.009215549565851688</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.005282022058963776</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0023747326340526342</span><span class="p">,</span><span class="w"> </span><span class="mf">0.002623362001031637</span><span class="p">,</span><span class="w"> </span><span class="mf">0.003890525083988905</span><span class="p">,</span><span class="w"> </span><span class="mf">6.010813522152603e-4</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.0024882694706320763</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0029246946796774864</span><span class="p" data-group-id="9257512794-5">]</span><span class="w">
    </span><span class="p" data-group-id="9257512794-3">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-6">#</span><span class="nc" data-group-id="9257512794-6">Nx.Tensor</span><span class="p" data-group-id="9257512794-6">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9257512794-7">[</span><span class="mi">1</span><span class="p" data-group-id="9257512794-7">]</span><span class="p" data-group-id="9257512794-8">[</span><span class="mi">8</span><span class="p" data-group-id="9257512794-8">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-9">[</span><span class="w">
        </span><span class="p" data-group-id="9257512794-10">[</span><span class="o">-</span><span class="mf">0.3484582304954529</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.39938971400260925</span><span class="p">,</span><span class="w"> </span><span class="mf">0.03963512182235718</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3549930155277252</span><span class="p">,</span><span class="w"> </span><span class="mf">0.09539157152175903</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5987873077392578</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.23635399341583252</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01850329153239727</span><span class="p" data-group-id="9257512794-10">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-9">]</span><span class="w">
    </span><span class="p" data-group-id="9257512794-6">&gt;</span><span class="w">
  </span><span class="p" data-group-id="9257512794-2">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-11">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-12">#</span><span class="nc" data-group-id="9257512794-12">Nx.Tensor</span><span class="p" data-group-id="9257512794-12">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9257512794-13">[</span><span class="mi">4</span><span class="p" data-group-id="9257512794-13">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-14">[</span><span class="o">-</span><span class="mf">0.00194685033056885</span><span class="p">,</span><span class="w"> </span><span class="mf">0.007812315598130226</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01710106059908867</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0080711729824543</span><span class="p" data-group-id="9257512794-14">]</span><span class="w">
    </span><span class="p" data-group-id="9257512794-12">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-15">#</span><span class="nc" data-group-id="9257512794-15">Nx.Tensor</span><span class="p" data-group-id="9257512794-15">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9257512794-16">[</span><span class="mi">8</span><span class="p" data-group-id="9257512794-16">]</span><span class="p" data-group-id="9257512794-17">[</span><span class="mi">4</span><span class="p" data-group-id="9257512794-17">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-18">[</span><span class="w">
        </span><span class="p" data-group-id="9257512794-19">[</span><span class="o">-</span><span class="mf">0.6497661471366882</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3379145562648773</span><span class="p">,</span><span class="w"> </span><span class="mf">0.3343344032764435</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4334254860877991</span><span class="p" data-group-id="9257512794-19">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-20">[</span><span class="o">-</span><span class="mf">0.37884217500686646</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.41724908351898193</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.19513007998466492</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.22494879364967346</span><span class="p" data-group-id="9257512794-20">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-21">[</span><span class="o">-</span><span class="mf">0.42438197135925293</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.40400123596191406</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5355109572410583</span><span class="p">,</span><span class="w"> </span><span class="mf">0.4295356869697571</span><span class="p" data-group-id="9257512794-21">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-22">[</span><span class="mf">0.15086597204208374</span><span class="p">,</span><span class="w"> </span><span class="mf">0.30529624223709106</span><span class="p">,</span><span class="w"> </span><span class="mf">0.002222923096269369</span><span class="p">,</span><span class="w"> </span><span class="mf">0.32834741473197937</span><span class="p" data-group-id="9257512794-22">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-23">[</span><span class="o">-</span><span class="mf">0.09336567670106888</span><span class="p">,</span><span class="w"> </span><span class="mf">0.471781849861145</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.06567475199699402</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4361487627029419</span><span class="p" data-group-id="9257512794-23">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-24">[</span><span class="mf">0.23664812743663788</span><span class="p">,</span><span class="w"> </span><span class="mf">0.13572633266448975</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.13837064802646637</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.09471122920513153</span><span class="p" data-group-id="9257512794-24">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-25">[</span><span class="mf">0.6461064219474792</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.2435072958469391</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.04861235246062279</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1969985067844391</span><span class="p" data-group-id="9257512794-25">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-26">[</span><span class="mf">0.17856749892234802</span><span class="p">,</span><span class="w"> </span><span class="mf">0.41614532470703125</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.06008348613977432</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.3271574079990387</span><span class="p" data-group-id="9257512794-26">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-18">]</span><span class="w">
    </span><span class="p" data-group-id="9257512794-15">&gt;</span><span class="w">
  </span><span class="p" data-group-id="9257512794-11">}</span><span class="p">,</span><span class="w">
  </span><span class="s">&quot;dense_2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-27">%{</span><span class="w">
    </span><span class="s">&quot;bias&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-28">#</span><span class="nc" data-group-id="9257512794-28">Nx.Tensor</span><span class="p" data-group-id="9257512794-28">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9257512794-29">[</span><span class="mi">1</span><span class="p" data-group-id="9257512794-29">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-30">[</span><span class="o">-</span><span class="mf">0.005317525006830692</span><span class="p" data-group-id="9257512794-30">]</span><span class="w">
    </span><span class="p" data-group-id="9257512794-28">&gt;</span><span class="p">,</span><span class="w">
    </span><span class="s">&quot;kernel&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p" data-group-id="9257512794-31">#</span><span class="nc" data-group-id="9257512794-31">Nx.Tensor</span><span class="p" data-group-id="9257512794-31">&lt;</span><span class="w">
      </span><span class="n">f32</span><span class="p" data-group-id="9257512794-32">[</span><span class="mi">4</span><span class="p" data-group-id="9257512794-32">]</span><span class="p" data-group-id="9257512794-33">[</span><span class="mi">1</span><span class="p" data-group-id="9257512794-33">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-34">[</span><span class="w">
        </span><span class="p" data-group-id="9257512794-35">[</span><span class="o">-</span><span class="mf">0.07891849428415298</span><span class="p" data-group-id="9257512794-35">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-36">[</span><span class="mf">0.32653072476387024</span><span class="p" data-group-id="9257512794-36">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-37">[</span><span class="o">-</span><span class="mf">0.5885495543479919</span><span class="p" data-group-id="9257512794-37">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="9257512794-38">[</span><span class="o">-</span><span class="mf">0.2781771719455719</span><span class="p" data-group-id="9257512794-38">]</span><span class="w">
      </span><span class="p" data-group-id="9257512794-34">]</span><span class="w">
    </span><span class="p" data-group-id="9257512794-31">&gt;</span><span class="w">
  </span><span class="p" data-group-id="9257512794-27">}</span><span class="w">
</span><span class="p" data-group-id="9257512794-1">}</span></code></pre><p>You may access and update any portion of the loop state. Keep in mind that event handlers are <strong>not</strong> JIT-compiled, so you should be certain to manually JIT-compile any long-running or expensive operations.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="writing_custom_metrics.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          â† Previous Page
        </span>
        <span class="title">
Writing custom metrics
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="onnx_to_axon.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page â†’
        </span>
        <span class="title">
Converting ONNX models to Axon
        </span>
      </a>

  </div>
</div>
      <footer class="footer">
        <p>

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.6.1" class="footer-hex-package">Hex Package</a>

              <a href="https://preview.hex.pm/preview/axon/0.6.1">Hex Preview</a>

                (<a href="https://preview.hex.pm/preview/axon/0.6.1/show/guides/training_and_evaluation/writing_custom_event_handlers.livemd">current file</a>)

            </span>

          <span class="line">
            <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
              Search HexDocs
            </button>

              <a href="Axon.epub" title="ePub version">
                Download ePub version
              </a>

          </span>
        </p>

        <p class="built-using">
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.31.1) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</main>
</div>

<!-- Render math with KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ]
    });
  });
</script>

<!-- Render diagrams with Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.3/dist/mermaid.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    mermaid.initialize({ startOnLoad: false });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition, function (svgSource, bindListeners) {
        graphEl.innerHTML = svgSource;
        bindListeners && bindListeners(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  });
</script>

  </body>
</html>
