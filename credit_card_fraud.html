<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.5">
    <meta name="project" content="Axon v0.2.0">

    <title>Classifying fraudulent transactions â€” Axon v0.2.0</title>
    <link rel="stylesheet" href="dist/elixir-64c5e2b63575bddb1c5b.css" />

    <script src="dist/sidebar_items-6168b73512.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-b5f3440501744dc8be3d.js"></script>


  </head>
  <body data-type="extras">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">


<section class="sidebar">
  <button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
    <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
  </button>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="Axon.html">
        <img src="assets/logo.png" alt="Axon" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.2.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/elixir-nx/axon/blob/v0.2.0/notebooks/structured/credit_card_fraud.livemd#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span>Classifying fraudulent transactions</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<h2 id="general-overview" class="section-heading">
  <a href="#general-overview" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">general-overview</p>
  </a>
  General overview
</h2>
<p>This time we will examine the Credit Card Fraud Data set. Due to confidentiality, the original data were preprocessed by PCA, and then 31 principal components were selected for the final data set. The dataset is highly imbalanced. The positive class (frauds) account for 0.172% of all transactions. Eventually, we will create a classifier which has not only great accuracy but, what is even more important, a high <em>recall</em> and <em>precision</em>---which are metrics that are much more indicative of performance with imbalanced classification problems</p><h2 id="imports" class="section-heading">
  <a href="#imports" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">imports</p>
  </a>
  Imports
</h2>
<p>Since we'll operate on tabular data, we will use the <code class="inline">Explorer</code> package extensively. We will also use <a href="Axon.html"><code class="inline">Axon</code></a> and <a href="https://hexdocs.pm/nx/0.3.0/Nx.html"><code class="inline">Nx</code></a> for building a machine learning model and for tensor manipulations.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="0200680364-1">(</span><span class="p" data-group-id="0200680364-2">[</span><span class="w">
  </span><span class="p" data-group-id="0200680364-3">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.1.0&quot;</span><span class="p" data-group-id="0200680364-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0200680364-4">{</span><span class="ss">:exla</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.2.2&quot;</span><span class="p" data-group-id="0200680364-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0200680364-5">{</span><span class="ss">:nx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.2.1&quot;</span><span class="p" data-group-id="0200680364-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="0200680364-6">{</span><span class="ss">:explorer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.2.0&quot;</span><span class="p" data-group-id="0200680364-6">}</span><span class="w">
</span><span class="p" data-group-id="0200680364-2">]</span><span class="p" data-group-id="0200680364-1">)</span><span class="w">

</span><span class="nc">EXLA</span><span class="o">.</span><span class="n">set_as_nx_default</span><span class="p" data-group-id="0200680364-7">(</span><span class="p" data-group-id="0200680364-8">[</span><span class="ss">:tpu</span><span class="p">,</span><span class="w"> </span><span class="ss">:cuda</span><span class="p">,</span><span class="w"> </span><span class="ss">:rocm</span><span class="p">,</span><span class="w"> </span><span class="ss">:host</span><span class="p" data-group-id="0200680364-8">]</span><span class="p" data-group-id="0200680364-7">)</span></code></pre><h2 id="data-processing" class="section-heading">
  <a href="#data-processing" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">data-processing</p>
  </a>
  Data processing
</h2>
<p>The first step is to prepare the data for training and evaluation. We load the data set into an <code class="inline">Explorer.DataFrame</code> object from CSV. Then we split the data into training and test data (in proportion 80% into a training set and 20% into a test set) using the <em>split_train_test</em> function. In the next step, we separate features from target labels using <em>split_features_targets</em>. Now we should normalize the data to our neural-net performs better. The normalize_data function divides each value for a particular feature by the maximum absolute value in this feature. In the end, we cast data frames into tensors with <em>df_to_tensor</em>.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Download data with a Kaggle account: https://www.kaggle.com/mlg-ulb/creditcardfraud/</span><span class="w">
</span><span class="na">@file_name</span><span class="w"> </span><span class="s">&quot;creditcard.csv&quot;</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">data</span><span class="p" data-group-id="0635014647-1">(</span><span class="p" data-group-id="0635014647-1">)</span><span class="w"> </span><span class="k" data-group-id="0635014647-2">do</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="0635014647-3">(</span><span class="s">&quot;Loading </span><span class="si" data-group-id="0635014647-4">#{</span><span class="na">@file_name</span><span class="si" data-group-id="0635014647-4">}</span><span class="s">&quot;</span><span class="p" data-group-id="0635014647-3">)</span><span class="w">
  </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">from_csv!</span><span class="p" data-group-id="0635014647-5">(</span><span class="na">@file_name</span><span class="p">,</span><span class="w"> </span><span class="ss">dtypes</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0635014647-6">[</span><span class="p" data-group-id="0635014647-7">{</span><span class="s">&quot;Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:float</span><span class="p" data-group-id="0635014647-7">}</span><span class="p" data-group-id="0635014647-6">]</span><span class="p" data-group-id="0635014647-5">)</span><span class="w">

  </span><span class="p" data-group-id="0635014647-8">{</span><span class="n">train_df</span><span class="p">,</span><span class="w"> </span><span class="n">test_df</span><span class="p" data-group-id="0635014647-8">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">split_train_test</span><span class="p" data-group-id="0635014647-9">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p" data-group-id="0635014647-9">)</span><span class="w">

  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="0635014647-10">(</span><span class="s">&quot;Training Samples: </span><span class="si" data-group-id="0635014647-11">#{</span><span class="n">inspect</span><span class="p" data-group-id="0635014647-12">(</span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">n_rows</span><span class="p" data-group-id="0635014647-13">(</span><span class="n">train_df</span><span class="p" data-group-id="0635014647-13">)</span><span class="p" data-group-id="0635014647-12">)</span><span class="si" data-group-id="0635014647-11">}</span><span class="s">&quot;</span><span class="p" data-group-id="0635014647-10">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="0635014647-14">(</span><span class="s">&quot;Testing Samples: </span><span class="si" data-group-id="0635014647-15">#{</span><span class="n">inspect</span><span class="p" data-group-id="0635014647-16">(</span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">n_rows</span><span class="p" data-group-id="0635014647-17">(</span><span class="n">test_df</span><span class="p" data-group-id="0635014647-17">)</span><span class="p" data-group-id="0635014647-16">)</span><span class="si" data-group-id="0635014647-15">}</span><span class="s">&quot;</span><span class="p" data-group-id="0635014647-14">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="p" data-group-id="0635014647-18">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="se">\n</span><span class="s">&quot;</span><span class="p" data-group-id="0635014647-18">)</span><span class="w">

  </span><span class="p" data-group-id="0635014647-19">{</span><span class="n">train_features</span><span class="p">,</span><span class="w"> </span><span class="n">train_targets</span><span class="p" data-group-id="0635014647-19">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">split_features_targets</span><span class="p" data-group-id="0635014647-20">(</span><span class="n">train_df</span><span class="p" data-group-id="0635014647-20">)</span><span class="w">
  </span><span class="p" data-group-id="0635014647-21">{</span><span class="n">test_features</span><span class="p">,</span><span class="w"> </span><span class="n">test_targets</span><span class="p" data-group-id="0635014647-21">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">split_features_targets</span><span class="p" data-group-id="0635014647-22">(</span><span class="n">test_df</span><span class="p" data-group-id="0635014647-22">)</span><span class="w">

  </span><span class="n">train_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize_data</span><span class="p" data-group-id="0635014647-23">(</span><span class="n">train_features</span><span class="p" data-group-id="0635014647-23">)</span><span class="w">
  </span><span class="n">test_features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize_data</span><span class="p" data-group-id="0635014647-24">(</span><span class="n">test_features</span><span class="p" data-group-id="0635014647-24">)</span><span class="w">

  </span><span class="p" data-group-id="0635014647-25">{</span><span class="w">
    </span><span class="p" data-group-id="0635014647-26">{</span><span class="n">df_to_tensor</span><span class="p" data-group-id="0635014647-27">(</span><span class="n">train_features</span><span class="p" data-group-id="0635014647-27">)</span><span class="p">,</span><span class="w"> </span><span class="n">df_to_tensor</span><span class="p" data-group-id="0635014647-28">(</span><span class="n">train_targets</span><span class="p" data-group-id="0635014647-28">)</span><span class="p" data-group-id="0635014647-26">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0635014647-29">{</span><span class="n">df_to_tensor</span><span class="p" data-group-id="0635014647-30">(</span><span class="n">test_features</span><span class="p" data-group-id="0635014647-30">)</span><span class="p">,</span><span class="w"> </span><span class="n">df_to_tensor</span><span class="p" data-group-id="0635014647-31">(</span><span class="n">test_targets</span><span class="p" data-group-id="0635014647-31">)</span><span class="p" data-group-id="0635014647-29">}</span><span class="w">
  </span><span class="p" data-group-id="0635014647-25">}</span><span class="w">
</span><span class="k" data-group-id="0635014647-2">end</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">split_train_test</span><span class="p" data-group-id="0635014647-32">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">portion</span><span class="p" data-group-id="0635014647-32">)</span><span class="w"> </span><span class="k" data-group-id="0635014647-33">do</span><span class="w">
  </span><span class="n">num_examples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">n_rows</span><span class="p" data-group-id="0635014647-34">(</span><span class="n">df</span><span class="p" data-group-id="0635014647-34">)</span><span class="w">
  </span><span class="n">num_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ceil</span><span class="p" data-group-id="0635014647-35">(</span><span class="n">portion</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">num_examples</span><span class="p" data-group-id="0635014647-35">)</span><span class="w">
  </span><span class="n">num_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_examples</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">num_train</span><span class="w">

  </span><span class="p" data-group-id="0635014647-36">{</span><span class="w">
    </span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">slice</span><span class="p" data-group-id="0635014647-37">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">num_train</span><span class="p" data-group-id="0635014647-37">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">slice</span><span class="p" data-group-id="0635014647-38">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">num_train</span><span class="p">,</span><span class="w"> </span><span class="n">num_test</span><span class="p" data-group-id="0635014647-38">)</span><span class="w">
  </span><span class="p" data-group-id="0635014647-36">}</span><span class="w">
</span><span class="k" data-group-id="0635014647-33">end</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">split_features_targets</span><span class="p" data-group-id="0635014647-39">(</span><span class="n">df</span><span class="p" data-group-id="0635014647-39">)</span><span class="w"> </span><span class="k" data-group-id="0635014647-40">do</span><span class="w">
  </span><span class="n">features</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">select</span><span class="p" data-group-id="0635014647-41">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="0635014647-42">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Class&quot;</span><span class="p" data-group-id="0635014647-42">)</span><span class="p">,</span><span class="w"> </span><span class="ss">:drop</span><span class="p" data-group-id="0635014647-41">)</span><span class="w">
  </span><span class="n">targets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">select</span><span class="p" data-group-id="0635014647-43">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="0635014647-44">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Class&quot;</span><span class="p" data-group-id="0635014647-44">)</span><span class="p">,</span><span class="w"> </span><span class="ss">:keep</span><span class="p" data-group-id="0635014647-43">)</span><span class="w">
  </span><span class="p" data-group-id="0635014647-45">{</span><span class="n">features</span><span class="p">,</span><span class="w"> </span><span class="n">targets</span><span class="p" data-group-id="0635014647-45">}</span><span class="w">
</span><span class="k" data-group-id="0635014647-40">end</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">normalize</span><span class="p" data-group-id="0635014647-46">(</span><span class="n">name</span><span class="p" data-group-id="0635014647-46">)</span><span class="p">,</span><span class="w">
  </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0635014647-47">fn</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Explorer.Series</span><span class="o">.</span><span class="n">divide</span><span class="p" data-group-id="0635014647-48">(</span><span class="w">
      </span><span class="n">df</span><span class="p" data-group-id="0635014647-49">[</span><span class="n">name</span><span class="p" data-group-id="0635014647-49">]</span><span class="p">,</span><span class="w">
      </span><span class="nc">Explorer.Series</span><span class="o">.</span><span class="n">max</span><span class="p" data-group-id="0635014647-50">(</span><span class="w">
        </span><span class="nc">Explorer.Series</span><span class="o">.</span><span class="n">transform</span><span class="p" data-group-id="0635014647-51">(</span><span class="n">df</span><span class="p" data-group-id="0635014647-52">[</span><span class="n">name</span><span class="p" data-group-id="0635014647-52">]</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="0635014647-53">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="0635014647-54">do</span><span class="w">
            </span><span class="n">x</span><span class="w">
          </span><span class="k" data-group-id="0635014647-54">else</span><span class="w">
            </span><span class="o">-</span><span class="n">x</span><span class="w">
          </span><span class="k" data-group-id="0635014647-54">end</span><span class="w">
        </span><span class="k" data-group-id="0635014647-53">end</span><span class="p" data-group-id="0635014647-51">)</span><span class="w">
      </span><span class="p" data-group-id="0635014647-50">)</span><span class="w">
    </span><span class="p" data-group-id="0635014647-48">)</span><span class="w">
  </span><span class="k" data-group-id="0635014647-47">end</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">normalize_data</span><span class="p" data-group-id="0635014647-55">(</span><span class="n">df</span><span class="p" data-group-id="0635014647-55">)</span><span class="w"> </span><span class="k" data-group-id="0635014647-56">do</span><span class="w">
  </span><span class="n">df</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">names</span><span class="p" data-group-id="0635014647-57">(</span><span class="p" data-group-id="0635014647-57">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="0635014647-58">(</span><span class="o">&amp;</span><span class="p" data-group-id="0635014647-59">{</span><span class="ni">&amp;1</span><span class="p">,</span><span class="w"> </span><span class="n">normalize</span><span class="p" data-group-id="0635014647-60">(</span><span class="ni">&amp;1</span><span class="p" data-group-id="0635014647-60">)</span><span class="p" data-group-id="0635014647-59">}</span><span class="p" data-group-id="0635014647-58">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">then</span><span class="p" data-group-id="0635014647-61">(</span><span class="o">&amp;</span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">mutate</span><span class="p" data-group-id="0635014647-62">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="0635014647-62">)</span><span class="p" data-group-id="0635014647-61">)</span><span class="w">
</span><span class="k" data-group-id="0635014647-56">end</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">df_to_tensor</span><span class="p" data-group-id="0635014647-63">(</span><span class="n">df</span><span class="p" data-group-id="0635014647-63">)</span><span class="w"> </span><span class="k" data-group-id="0635014647-64">do</span><span class="w">
  </span><span class="n">df</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Explorer.DataFrame</span><span class="o">.</span><span class="n">names</span><span class="p" data-group-id="0635014647-65">(</span><span class="p" data-group-id="0635014647-65">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="0635014647-66">(</span><span class="o">&amp;</span><span class="p" data-group-id="0635014647-67">(</span><span class="nc">Explorer.Series</span><span class="o">.</span><span class="n">to_tensor</span><span class="p" data-group-id="0635014647-68">(</span><span class="n">df</span><span class="p" data-group-id="0635014647-69">[</span><span class="ni">&amp;1</span><span class="p" data-group-id="0635014647-69">]</span><span class="p" data-group-id="0635014647-68">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">new_axis</span><span class="p" data-group-id="0635014647-70">(</span><span class="o">-</span><span class="mi">1</span><span class="p" data-group-id="0635014647-70">)</span><span class="p" data-group-id="0635014647-67">)</span><span class="p" data-group-id="0635014647-66">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">concatenate</span><span class="p" data-group-id="0635014647-71">(</span><span class="ss">axis</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="0635014647-71">)</span><span class="w">
</span><span class="k" data-group-id="0635014647-64">end</span></code></pre><h2 id="building-the-model" class="section-heading">
  <a href="#building-the-model" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">building-the-model</p>
  </a>
  Building the model
</h2>
<p>Our model for predicting whether a transaction was fraudulent or not is a dense neural net. It consists of two dense layers with 256 neurons, ReLU activation functions, one dropout layer, and a dense layer with one neuron (since the problem is binary prediction) followed by a sigmoid activation function.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defp</span><span class="w"> </span><span class="nf">build_model</span><span class="p" data-group-id="0336271195-1">(</span><span class="n">num_features</span><span class="p" data-group-id="0336271195-1">)</span><span class="w"> </span><span class="k" data-group-id="0336271195-2">do</span><span class="w">
  </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="0336271195-3">(</span><span class="p" data-group-id="0336271195-4">{</span><span class="no">nil</span><span class="p">,</span><span class="w"> </span><span class="n">num_features</span><span class="p" data-group-id="0336271195-4">}</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;input&quot;</span><span class="p" data-group-id="0336271195-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="0336271195-5">(</span><span class="mi">256</span><span class="p" data-group-id="0336271195-5">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="0336271195-6">(</span><span class="p" data-group-id="0336271195-6">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="0336271195-7">(</span><span class="mi">256</span><span class="p" data-group-id="0336271195-7">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">relu</span><span class="p" data-group-id="0336271195-8">(</span><span class="p" data-group-id="0336271195-8">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dropout</span><span class="p" data-group-id="0336271195-9">(</span><span class="ss">rate</span><span class="p">:</span><span class="w"> </span><span class="mf">0.3</span><span class="p" data-group-id="0336271195-9">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="0336271195-10">(</span><span class="mi">1</span><span class="p" data-group-id="0336271195-10">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">sigmoid</span><span class="p" data-group-id="0336271195-11">(</span><span class="p" data-group-id="0336271195-11">)</span><span class="w">
</span><span class="k" data-group-id="0336271195-2">end</span></code></pre><h2 id="training-testing-summary" class="section-heading">
  <a href="#training-testing-summary" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">training-testing-summary</p>
  </a>
  Training, testing &amp; summary
</h2>
<p>Now since we have both data and model architecture prepared, we design training and test loops. In <em>train_model</em>, we pass the loss function and optimizer of our choice and run 30 epochs of the learning process. After the training, there is only one thing left: testing. In <em>test_model</em>, we will focus on the number of true positive, true negative, false positive, and false negative values but also on the likelihood of denying legit and fraudulent transactions.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defp</span><span class="w"> </span><span class="nf">train_model</span><span class="p" data-group-id="1748603618-1">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p">,</span><span class="w"> </span><span class="n">train_data</span><span class="p" data-group-id="1748603618-1">)</span><span class="w"> </span><span class="k" data-group-id="1748603618-2">do</span><span class="w">
  </span><span class="n">model</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="1748603618-3">(</span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p" data-group-id="1748603618-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1748603618-4">(</span><span class="n">train_data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1748603618-5">%{</span><span class="p" data-group-id="1748603618-5">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="1748603618-4">)</span><span class="w">
</span><span class="k" data-group-id="1748603618-2">end</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">test_model</span><span class="p" data-group-id="1748603618-6">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">model_state</span><span class="p">,</span><span class="w"> </span><span class="n">test_data</span><span class="p" data-group-id="1748603618-6">)</span><span class="w"> </span><span class="k" data-group-id="1748603618-7">do</span><span class="w">
  </span><span class="n">model</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">evaluator</span><span class="p" data-group-id="1748603618-8">(</span><span class="p" data-group-id="1748603618-8">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">metrics</span><span class="p" data-group-id="1748603618-9">(</span><span class="p" data-group-id="1748603618-9">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">handle</span><span class="p" data-group-id="1748603618-10">(</span><span class="ss">:epoch_completed</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">summarize</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="1748603618-10">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1748603618-11">(</span><span class="n">test_data</span><span class="p">,</span><span class="w"> </span><span class="n">model_state</span><span class="p">,</span><span class="w"> </span><span class="ss">compiler</span><span class="p">:</span><span class="w"> </span><span class="nc">EXLA</span><span class="p" data-group-id="1748603618-11">)</span><span class="w">
</span><span class="k" data-group-id="1748603618-7">end</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">summarize</span><span class="p" data-group-id="1748603618-12">(</span><span class="p" data-group-id="1748603618-13">%</span><span class="nc" data-group-id="1748603618-13">State</span><span class="p" data-group-id="1748603618-13">{</span><span class="ss">metrics</span><span class="p">:</span><span class="w"> </span><span class="n">metrics</span><span class="p" data-group-id="1748603618-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="1748603618-12">)</span><span class="w"> </span><span class="k" data-group-id="1748603618-14">do</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="p" data-group-id="1748603618-15">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="se">\n</span><span class="s">&quot;</span><span class="p" data-group-id="1748603618-15">)</span><span class="w">

  </span><span class="n">legit_transactions_declined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_number</span><span class="p" data-group-id="1748603618-16">(</span><span class="n">metrics</span><span class="p" data-group-id="1748603618-17">[</span><span class="s">&quot;fp&quot;</span><span class="p" data-group-id="1748603618-17">]</span><span class="p" data-group-id="1748603618-16">)</span><span class="w">
  </span><span class="n">legit_transactions_accepted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_number</span><span class="p" data-group-id="1748603618-18">(</span><span class="n">metrics</span><span class="p" data-group-id="1748603618-19">[</span><span class="s">&quot;tn&quot;</span><span class="p" data-group-id="1748603618-19">]</span><span class="p" data-group-id="1748603618-18">)</span><span class="w">
  </span><span class="n">fraud_transactions_accepted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_number</span><span class="p" data-group-id="1748603618-20">(</span><span class="n">metrics</span><span class="p" data-group-id="1748603618-21">[</span><span class="s">&quot;fn&quot;</span><span class="p" data-group-id="1748603618-21">]</span><span class="p" data-group-id="1748603618-20">)</span><span class="w">
  </span><span class="n">fraud_transactions_declined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_number</span><span class="p" data-group-id="1748603618-22">(</span><span class="n">metrics</span><span class="p" data-group-id="1748603618-23">[</span><span class="s">&quot;tp&quot;</span><span class="p" data-group-id="1748603618-23">]</span><span class="p" data-group-id="1748603618-22">)</span><span class="w">
  </span><span class="n">total_fraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fraud_transactions_declined</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fraud_transactions_accepted</span><span class="w">
  </span><span class="n">total_legit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">legit_transactions_declined</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">legit_transactions_accepted</span><span class="w">

  </span><span class="n">fraud_denial_percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p" data-group-id="1748603618-24">(</span><span class="n">fraud_transactions_declined</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_fraud</span><span class="p" data-group-id="1748603618-24">)</span><span class="w">
  </span><span class="n">legit_denial_percent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p" data-group-id="1748603618-25">(</span><span class="n">legit_transactions_declined</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">total_legit</span><span class="p" data-group-id="1748603618-25">)</span><span class="w">

  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="1748603618-26">(</span><span class="s">&quot;Legit Transactions Declined: </span><span class="si" data-group-id="1748603618-27">#{</span><span class="n">legit_transactions_declined</span><span class="si" data-group-id="1748603618-27">}</span><span class="s">&quot;</span><span class="p" data-group-id="1748603618-26">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="1748603618-28">(</span><span class="s">&quot;Fraudulent Transactions Caught: </span><span class="si" data-group-id="1748603618-29">#{</span><span class="n">fraud_transactions_declined</span><span class="si" data-group-id="1748603618-29">}</span><span class="s">&quot;</span><span class="p" data-group-id="1748603618-28">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="1748603618-30">(</span><span class="s">&quot;Fraudulent Transactions Missed: </span><span class="si" data-group-id="1748603618-31">#{</span><span class="n">fraud_transactions_accepted</span><span class="si" data-group-id="1748603618-31">}</span><span class="s">&quot;</span><span class="p" data-group-id="1748603618-30">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="1748603618-32">(</span><span class="s">&quot;Likelihood of catching fraud: </span><span class="si" data-group-id="1748603618-33">#{</span><span class="n">fraud_denial_percent</span><span class="si" data-group-id="1748603618-33">}</span><span class="s">%&quot;</span><span class="p" data-group-id="1748603618-32">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="1748603618-34">(</span><span class="s">&quot;Likelihood of denying legit transaction: </span><span class="si" data-group-id="1748603618-35">#{</span><span class="n">legit_denial_percent</span><span class="si" data-group-id="1748603618-35">}</span><span class="s">%&quot;</span><span class="p" data-group-id="1748603618-34">)</span><span class="w">

  </span><span class="p" data-group-id="1748603618-36">{</span><span class="ss">:continue</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="1748603618-36">}</span><span class="w">
</span><span class="k" data-group-id="1748603618-14">end</span><span class="w">

</span><span class="kd">defp</span><span class="w"> </span><span class="nf">metrics</span><span class="p" data-group-id="1748603618-37">(</span><span class="n">loop</span><span class="p" data-group-id="1748603618-37">)</span><span class="w"> </span><span class="k" data-group-id="1748603618-38">do</span><span class="w">
  </span><span class="n">loop</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">metric</span><span class="p" data-group-id="1748603618-39">(</span><span class="ss">:true_positives</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tp&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:running_sum</span><span class="p" data-group-id="1748603618-39">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">metric</span><span class="p" data-group-id="1748603618-40">(</span><span class="ss">:true_negatives</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tn&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:running_sum</span><span class="p" data-group-id="1748603618-40">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">metric</span><span class="p" data-group-id="1748603618-41">(</span><span class="ss">:false_positives</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fp&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:running_sum</span><span class="p" data-group-id="1748603618-41">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">metric</span><span class="p" data-group-id="1748603618-42">(</span><span class="ss">:false_negatives</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fn&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:running_sum</span><span class="p" data-group-id="1748603618-42">)</span><span class="w">
</span><span class="k" data-group-id="1748603618-38">end</span></code></pre><h2 id="model-evaluation" class="section-heading">
  <a href="#model-evaluation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">model-evaluation</p>
  </a>
  Model evaluation
</h2>
<p>In the end, we combine all things. Load and process data and then chunk them into batches. Next, create the model and set the loss function to binary cross-entropy and optimizer to adam with a learning rate of 0.01. then train and test the model.</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">run</span><span class="p" data-group-id="0675007941-1">(</span><span class="p" data-group-id="0675007941-1">)</span><span class="w"> </span><span class="k" data-group-id="0675007941-2">do</span><span class="w">
  </span><span class="p" data-group-id="0675007941-3">{</span><span class="n">train</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="p" data-group-id="0675007941-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p" data-group-id="0675007941-4">(</span><span class="p" data-group-id="0675007941-4">)</span><span class="w">
  </span><span class="p" data-group-id="0675007941-5">{</span><span class="n">train_inputs</span><span class="p">,</span><span class="w"> </span><span class="n">train_targets</span><span class="p" data-group-id="0675007941-5">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train</span><span class="w">
  </span><span class="p" data-group-id="0675007941-6">{</span><span class="n">test_inputs</span><span class="p">,</span><span class="w"> </span><span class="n">test_targets</span><span class="p" data-group-id="0675007941-6">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="w">

  </span><span class="n">fraud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="0675007941-7">(</span><span class="n">train_targets</span><span class="p" data-group-id="0675007941-7">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_number</span><span class="p" data-group-id="0675007941-8">(</span><span class="p" data-group-id="0675007941-8">)</span><span class="w">
  </span><span class="n">legit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">size</span><span class="p" data-group-id="0675007941-9">(</span><span class="n">train_targets</span><span class="p" data-group-id="0675007941-9">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fraud</span><span class="w">

  </span><span class="n">batched_train_inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_batched_list</span><span class="p" data-group-id="0675007941-10">(</span><span class="n">train_inputs</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p" data-group-id="0675007941-10">)</span><span class="w">
  </span><span class="n">batched_train_targets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_batched_list</span><span class="p" data-group-id="0675007941-11">(</span><span class="n">train_targets</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p" data-group-id="0675007941-11">)</span><span class="w">
  </span><span class="n">batched_train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Stream</span><span class="o">.</span><span class="n">zip</span><span class="p" data-group-id="0675007941-12">(</span><span class="n">batched_train_inputs</span><span class="p">,</span><span class="w"> </span><span class="n">batched_train_targets</span><span class="p" data-group-id="0675007941-12">)</span><span class="w">

  </span><span class="n">batched_test_inputs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_batched_list</span><span class="p" data-group-id="0675007941-13">(</span><span class="n">test_inputs</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p" data-group-id="0675007941-13">)</span><span class="w">
  </span><span class="n">batched_test_targets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">to_batched_list</span><span class="p" data-group-id="0675007941-14">(</span><span class="n">test_targets</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p" data-group-id="0675007941-14">)</span><span class="w">
  </span><span class="n">batched_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Stream</span><span class="o">.</span><span class="n">zip</span><span class="p" data-group-id="0675007941-15">(</span><span class="n">batched_test_inputs</span><span class="p">,</span><span class="w"> </span><span class="n">batched_test_targets</span><span class="p" data-group-id="0675007941-15">)</span><span class="w">

  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="0675007941-16">(</span><span class="s">&quot;# of legit transactions (train): </span><span class="si" data-group-id="0675007941-17">#{</span><span class="n">legit</span><span class="si" data-group-id="0675007941-17">}</span><span class="s">&quot;</span><span class="p" data-group-id="0675007941-16">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="0675007941-18">(</span><span class="s">&quot;# of fraudulent transactions (train): </span><span class="si" data-group-id="0675007941-19">#{</span><span class="n">fraud</span><span class="si" data-group-id="0675007941-19">}</span><span class="s">&quot;</span><span class="p" data-group-id="0675007941-18">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="0675007941-20">(</span><span class="s">&quot;% fraudlent transactions (train): </span><span class="si" data-group-id="0675007941-21">#{</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p" data-group-id="0675007941-22">(</span><span class="n">fraud</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p" data-group-id="0675007941-23">(</span><span class="n">legit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fraud</span><span class="p" data-group-id="0675007941-23">)</span><span class="p" data-group-id="0675007941-22">)</span><span class="si" data-group-id="0675007941-21">}</span><span class="s">%&quot;</span><span class="p" data-group-id="0675007941-20">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="p" data-group-id="0675007941-24">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="se">\n</span><span class="s">&quot;</span><span class="p" data-group-id="0675007941-24">)</span><span class="w">

  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">build_model</span><span class="p" data-group-id="0675007941-25">(</span><span class="n">elem</span><span class="p" data-group-id="0675007941-26">(</span><span class="n">train_inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="0675007941-26">)</span><span class="p" data-group-id="0675007941-25">)</span><span class="w">

  </span><span class="n">loss</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="o">&amp;</span><span class="nc">Axon.Losses</span><span class="o">.</span><span class="n">binary_cross_entropy</span><span class="p" data-group-id="0675007941-27">(</span><span class="w">
      </span><span class="ni">&amp;1</span><span class="p">,</span><span class="w">
      </span><span class="ni">&amp;2</span><span class="p">,</span><span class="w">
      </span><span class="ss">negative_weight</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">legit</span><span class="p">,</span><span class="w">
      </span><span class="ss">positive_weight</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">fraud</span><span class="p">,</span><span class="w">
      </span><span class="ss">reduction</span><span class="p">:</span><span class="w"> </span><span class="ss">:mean</span><span class="w">
    </span><span class="p" data-group-id="0675007941-27">)</span><span class="w">

  </span><span class="n">optimizer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon.Optimizers</span><span class="o">.</span><span class="n">adam</span><span class="p" data-group-id="0675007941-28">(</span><span class="mf">1.0e-2</span><span class="p" data-group-id="0675007941-28">)</span><span class="w">

  </span><span class="n">model</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">train_model</span><span class="p" data-group-id="0675007941-29">(</span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p">,</span><span class="w"> </span><span class="n">batched_train</span><span class="p" data-group-id="0675007941-29">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">then</span><span class="p" data-group-id="0675007941-30">(</span><span class="o">&amp;</span><span class="n">test_model</span><span class="p" data-group-id="0675007941-31">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p">,</span><span class="w"> </span><span class="n">batched_test</span><span class="p" data-group-id="0675007941-31">)</span><span class="p" data-group-id="0675007941-30">)</span><span class="w">
</span><span class="k" data-group-id="0675007941-2">end</span></code></pre>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="text_generator.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          â† Previous Page
        </span>
        <span class="title">
Generating text with an LSTM
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="fashionmnist_autoencoder.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page â†’
        </span>
        <span class="title">
Training an Autoencoder on Fashion MNIST
        </span>
      </a>

  </div>
</div>

      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.2.0" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/axon/0.2.0" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/axon/0.2.0/show/notebooks/structured/credit_card_fraud.livemd">(current file)</a>

            </span>

            <button class="line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.5) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

  </body>
</html>
