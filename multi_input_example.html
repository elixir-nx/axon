<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.4">
    <meta name="project" content="Axon v0.2.0-dev">

    <title>Multi Input Models — Axon v0.2.0-dev</title>
    <link rel="stylesheet" href="dist/elixir-b6f1ed5df9b1d42a7309.css" />

    <script src="dist/sidebar_items-690956fb12.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-bd1cb213813bf4825aa2.js"></script>


  </head>
  <body data-type="extras">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">


<section class="sidebar">
  <button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
    <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
  </button>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="Axon.html">
        <img src="assets/logo.png" alt="Axon" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.2.0-dev
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/elixir-nx/axon/blob/v0.2.0-dev/notebooks/multi_input_example.livemd#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span>Multi Input Models</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<h2 id="imports" class="section-heading">
  <a href="#imports" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">imports</p>
  </a>
  Imports
</h2>
<p>At the very beginning, we have to import essential packages. <a href="Axon.html"><code class="inline">Axon</code></a> will be the primary tool to build a deep learning model. Apart from that, we need to import <code class="inline">EXLA</code> to accelerate calculations and <a href="https://hexdocs.pm/nx/0.3.0-dev/Nx.html"><code class="inline">Nx</code></a> since it gives us useful functions like <code class="inline">Nx.to_heatmap</code> and tensor operations.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="9262900389-1">(</span><span class="p" data-group-id="9262900389-2">[</span><span class="w">
  </span><span class="p" data-group-id="9262900389-3">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.1.0&quot;</span><span class="p" data-group-id="9262900389-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="9262900389-4">{</span><span class="ss">:exla</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.2.2&quot;</span><span class="p" data-group-id="9262900389-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="9262900389-5">{</span><span class="ss">:nx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.2.1&quot;</span><span class="p" data-group-id="9262900389-5">}</span><span class="w">
</span><span class="p" data-group-id="9262900389-2">]</span><span class="p" data-group-id="9262900389-1">)</span></code></pre><h2 id="xor-model" class="section-heading">
  <a href="#xor-model" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">xor-model</p>
  </a>
  XOR model
</h2>
<p>###</p><p>A &quot;single-layer&quot; perceptron can't implement XOR. The reason is because the classes in XOR are not linearly separable. You cannot draw a straight line to separate the points (0,0),(1,1) from the points (0,1),(1,0). The issue was overcame with deep learning methods. They can separate data with much more complicated patterns within the data.</p><h3 id="the-xor-module-task-is-to-imitate-a-logical-xor-operation" class="section-heading">
  <a href="#the-xor-module-task-is-to-imitate-a-logical-xor-operation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">the-xor-module-task-is-to-imitate-a-logical-xor-operation</p>
  </a>
  The XOR module task is to imitate a logical xor operation.
</h3>
<p>First, we need to build a model.  It contains an input layer with two inputs created by <code class="inline">Axon.input</code> and concatenated with <code class="inline">Axon.concatenate</code>. Then we have one hidden layer and one output layer both generated using <code class="inline">Axon.dense</code>. The model is a sequential neural net. In Axon, it's very convenient to create such a model. Just pipe a previous layer to the next layer using <code class="inline">|&gt;</code>, and that's it.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defp</span><span class="w"> </span><span class="nf">build_model</span><span class="p" data-group-id="5869340358-1">(</span><span class="n">input_shape1</span><span class="p">,</span><span class="w"> </span><span class="n">input_shape2</span><span class="p" data-group-id="5869340358-1">)</span><span class="w"> </span><span class="k" data-group-id="5869340358-2">do</span><span class="w">
  </span><span class="n">inp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="5869340358-3">(</span><span class="s">&quot;x1&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">shape</span><span class="p">:</span><span class="w"> </span><span class="n">input_shape1</span><span class="p" data-group-id="5869340358-3">)</span><span class="w">
  </span><span class="n">inp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="5869340358-4">(</span><span class="s">&quot;x2&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">shape</span><span class="p">:</span><span class="w"> </span><span class="n">input_shape2</span><span class="p" data-group-id="5869340358-4">)</span><span class="w">

  </span><span class="n">inp1</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">concatenate</span><span class="p" data-group-id="5869340358-5">(</span><span class="n">inp2</span><span class="p" data-group-id="5869340358-5">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="5869340358-6">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:tanh</span><span class="p" data-group-id="5869340358-6">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="5869340358-7">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:sigmoid</span><span class="p" data-group-id="5869340358-7">)</span><span class="w">
</span><span class="k" data-group-id="5869340358-2">end</span></code></pre><h2 id="data" class="section-heading">
  <a href="#data" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">data</p>
  </a>
  Data
</h2>
<p>The next step is to batch the training data. However, our batch function does a little more than just splitting or preprocessing input data - it generates data and labels. Since we want to compute the logical XOR of 2 inputs, we generate 2 batches of random binary inputs, and then compute a target using <code class="inline">Nx.logical_xor</code>.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defp</span><span class="w"> </span><span class="nf">batch</span><span class="w"> </span><span class="k" data-group-id="2400470525-1">do</span><span class="w">
  </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="2400470525-2">(</span><span class="k">for</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2400470525-3">[</span><span class="nc">Enum</span><span class="o">.</span><span class="n">random</span><span class="p" data-group-id="2400470525-4">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">1</span><span class="p" data-group-id="2400470525-4">)</span><span class="p" data-group-id="2400470525-3">]</span><span class="p" data-group-id="2400470525-2">)</span><span class="w">
  </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="2400470525-5">(</span><span class="k">for</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2400470525-6">[</span><span class="nc">Enum</span><span class="o">.</span><span class="n">random</span><span class="p" data-group-id="2400470525-7">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">1</span><span class="p" data-group-id="2400470525-7">)</span><span class="p" data-group-id="2400470525-6">]</span><span class="p" data-group-id="2400470525-5">)</span><span class="w">
  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">logical_xor</span><span class="p" data-group-id="2400470525-8">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p" data-group-id="2400470525-8">)</span><span class="w">
  </span><span class="p" data-group-id="2400470525-9">{</span><span class="p" data-group-id="2400470525-10">{</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p" data-group-id="2400470525-10">}</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="2400470525-9">}</span><span class="w">
</span><span class="k" data-group-id="2400470525-1">end</span></code></pre><h2 id="training" class="section-heading">
  <a href="#training" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">training</p>
  </a>
  Training
</h2>
<p>Then we define a training procedure. To implement the procedure pass the parameters of the training into <code class="inline">Axon.Loop.trainer</code>. In our case we use <em>binary cross entropy</em> for loss and <em>stochastic gradient descent</em> as the optimizer. We use binary cross entropy because we can consider the task of computing XOR the same as a binary classification problem. We want our output to have a binary label <code class="inline">0</code> or <code class="inline">1</code>, and binary cross entropy is typically used in these cases. Then run the training process with <code class="inline">Axon.Loop.run</code>.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defp</span><span class="w"> </span><span class="nf">train_model</span><span class="p" data-group-id="2115140293-1">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">epochs</span><span class="p" data-group-id="2115140293-1">)</span><span class="w"> </span><span class="k" data-group-id="2115140293-2">do</span><span class="w">
  </span><span class="n">model</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="2115140293-3">(</span><span class="ss">:binary_cross_entropy</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="2115140293-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2115140293-4">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2115140293-5">%{</span><span class="p" data-group-id="2115140293-5">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="n">epochs</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p" data-group-id="2115140293-4">)</span><span class="w">
</span><span class="k" data-group-id="2115140293-2">end</span></code></pre><h2 id="evaluation-of-the-model" class="section-heading">
  <a href="#evaluation-of-the-model" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">evaluation-of-the-model</p>
  </a>
  Evaluation of the model
</h2>
<p>Finally, we can test our model for sample data.</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">run</span><span class="w"> </span><span class="k" data-group-id="9447125023-1">do</span><span class="w">
  </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">build_model</span><span class="p" data-group-id="9447125023-2">(</span><span class="p" data-group-id="9447125023-3">{</span><span class="no">nil</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="9447125023-3">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9447125023-4">{</span><span class="no">nil</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="9447125023-4">}</span><span class="p" data-group-id="9447125023-2">)</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Stream</span><span class="o">.</span><span class="n">repeatedly</span><span class="p" data-group-id="9447125023-5">(</span><span class="o">&amp;</span><span class="n">batch</span><span class="o">/</span><span class="mi">0</span><span class="p" data-group-id="9447125023-5">)</span><span class="w">

  </span><span class="n">model_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train_model</span><span class="p" data-group-id="9447125023-6">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="9447125023-6">)</span><span class="w">

  </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="9447125023-7">(</span><span class="nc">Axon</span><span class="o">.</span><span class="n">predict</span><span class="p" data-group-id="9447125023-8">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">model_state</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9447125023-9">{</span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="9447125023-10">(</span><span class="p" data-group-id="9447125023-11">[</span><span class="p" data-group-id="9447125023-12">[</span><span class="mi">0</span><span class="p" data-group-id="9447125023-12">]</span><span class="p" data-group-id="9447125023-11">]</span><span class="p" data-group-id="9447125023-10">)</span><span class="p">,</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="9447125023-13">(</span><span class="p" data-group-id="9447125023-14">[</span><span class="p" data-group-id="9447125023-15">[</span><span class="mi">1</span><span class="p" data-group-id="9447125023-15">]</span><span class="p" data-group-id="9447125023-14">]</span><span class="p" data-group-id="9447125023-13">)</span><span class="p" data-group-id="9447125023-9">}</span><span class="p" data-group-id="9447125023-8">)</span><span class="p" data-group-id="9447125023-7">)</span><span class="w">
</span><span class="k" data-group-id="9447125023-1">end</span></code></pre><h2 id="everything-together" class="section-heading">
  <a href="#everything-together" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">everything-together</p>
  </a>
  Everything together
</h2>
<p>Now let's put everything in a module and try it out.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">XOR</span><span class="w"> </span><span class="k" data-group-id="3597511832-1">do</span><span class="w">
  </span><span class="kn">require</span><span class="w"> </span><span class="nc">Axon</span><span class="w">

  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">build_model</span><span class="p" data-group-id="3597511832-2">(</span><span class="n">input_shape1</span><span class="p">,</span><span class="w"> </span><span class="n">input_shape2</span><span class="p" data-group-id="3597511832-2">)</span><span class="w"> </span><span class="k" data-group-id="3597511832-3">do</span><span class="w">
    </span><span class="n">inp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="3597511832-4">(</span><span class="s">&quot;x1&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">shape</span><span class="p">:</span><span class="w"> </span><span class="n">input_shape1</span><span class="p" data-group-id="3597511832-4">)</span><span class="w">
    </span><span class="n">inp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="3597511832-5">(</span><span class="s">&quot;x2&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">shape</span><span class="p">:</span><span class="w"> </span><span class="n">input_shape2</span><span class="p" data-group-id="3597511832-5">)</span><span class="w">

    </span><span class="n">inp1</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">concatenate</span><span class="p" data-group-id="3597511832-6">(</span><span class="n">inp2</span><span class="p" data-group-id="3597511832-6">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="3597511832-7">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:tanh</span><span class="p" data-group-id="3597511832-7">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="3597511832-8">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:sigmoid</span><span class="p" data-group-id="3597511832-8">)</span><span class="w">
  </span><span class="k" data-group-id="3597511832-3">end</span><span class="w">

  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">batch</span><span class="w"> </span><span class="k" data-group-id="3597511832-9">do</span><span class="w">
    </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="3597511832-10">(</span><span class="k">for</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3597511832-11">[</span><span class="nc">Enum</span><span class="o">.</span><span class="n">random</span><span class="p" data-group-id="3597511832-12">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">1</span><span class="p" data-group-id="3597511832-12">)</span><span class="p" data-group-id="3597511832-11">]</span><span class="p" data-group-id="3597511832-10">)</span><span class="w">
    </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="3597511832-13">(</span><span class="k">for</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3597511832-14">[</span><span class="nc">Enum</span><span class="o">.</span><span class="n">random</span><span class="p" data-group-id="3597511832-15">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">1</span><span class="p" data-group-id="3597511832-15">)</span><span class="p" data-group-id="3597511832-14">]</span><span class="p" data-group-id="3597511832-13">)</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">logical_xor</span><span class="p" data-group-id="3597511832-16">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p" data-group-id="3597511832-16">)</span><span class="w">
    </span><span class="p" data-group-id="3597511832-17">{</span><span class="p" data-group-id="3597511832-18">%{</span><span class="s">&quot;x1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">x2</span><span class="p" data-group-id="3597511832-18">}</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p" data-group-id="3597511832-17">}</span><span class="w">
  </span><span class="k" data-group-id="3597511832-9">end</span><span class="w">

  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">train_model</span><span class="p" data-group-id="3597511832-19">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">epochs</span><span class="p" data-group-id="3597511832-19">)</span><span class="w"> </span><span class="k" data-group-id="3597511832-20">do</span><span class="w">
    </span><span class="n">model</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="3597511832-21">(</span><span class="ss">:binary_cross_entropy</span><span class="p">,</span><span class="w"> </span><span class="ss">:sgd</span><span class="p" data-group-id="3597511832-21">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3597511832-22">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3597511832-23">%{</span><span class="p" data-group-id="3597511832-23">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="n">epochs</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p" data-group-id="3597511832-22">)</span><span class="w">
  </span><span class="k" data-group-id="3597511832-20">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">run</span><span class="w"> </span><span class="k" data-group-id="3597511832-24">do</span><span class="w">
    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">build_model</span><span class="p" data-group-id="3597511832-25">(</span><span class="p" data-group-id="3597511832-26">{</span><span class="no">nil</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3597511832-26">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3597511832-27">{</span><span class="no">nil</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3597511832-27">}</span><span class="p" data-group-id="3597511832-25">)</span><span class="w">
    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Stream</span><span class="o">.</span><span class="n">repeatedly</span><span class="p" data-group-id="3597511832-28">(</span><span class="o">&amp;</span><span class="n">batch</span><span class="o">/</span><span class="mi">0</span><span class="p" data-group-id="3597511832-28">)</span><span class="w">

    </span><span class="n">model_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">train_model</span><span class="p" data-group-id="3597511832-29">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="3597511832-29">)</span><span class="w">

    </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="3597511832-30">(</span><span class="w">
        </span><span class="nc">Axon</span><span class="o">.</span><span class="n">predict</span><span class="p" data-group-id="3597511832-31">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">model_state</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3597511832-32">%{</span><span class="s">&quot;x1&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="3597511832-33">(</span><span class="p" data-group-id="3597511832-34">[</span><span class="p" data-group-id="3597511832-35">[</span><span class="mi">0</span><span class="p" data-group-id="3597511832-35">]</span><span class="p" data-group-id="3597511832-34">]</span><span class="p" data-group-id="3597511832-33">)</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x2&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="3597511832-36">(</span><span class="p" data-group-id="3597511832-37">[</span><span class="p" data-group-id="3597511832-38">[</span><span class="mi">1</span><span class="p" data-group-id="3597511832-38">]</span><span class="p" data-group-id="3597511832-37">]</span><span class="p" data-group-id="3597511832-36">)</span><span class="p" data-group-id="3597511832-32">}</span><span class="p" data-group-id="3597511832-31">)</span><span class="w">
    </span><span class="p" data-group-id="3597511832-30">)</span><span class="w">
  </span><span class="k" data-group-id="3597511832-24">end</span><span class="w">
</span><span class="k" data-group-id="3597511832-1">end</span></code></pre><h2 id="results" class="section-heading">
  <a href="#results" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">results</p>
  </a>
  Results
</h2>
<pre><code class="makeup elixir" translate="no"><span class="nc">XOR</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8045620660-1">(</span><span class="p" data-group-id="8045620660-1">)</span></code></pre><p>To improve the model performance, you can increase the number of training epochs.</p><p><a href="https://github.com/elixir-nx/axon/blob/main/examples/basics/multi_input_example.exs" title="XOR module">Link to the whole XOR module</a></p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="fashionmnist_autoencoder.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Fashion MNIST Autoencoder
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

  </div>
</div>

      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.2.0-dev" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/axon/0.2.0-dev" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/axon/0.2.0-dev/show/notebooks/multi_input_example.livemd">(current file)</a>

            </span>

            <button class="line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.4) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

  </body>
</html>
